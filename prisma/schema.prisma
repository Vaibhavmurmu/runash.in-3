generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model admin_activity_logs {
  id          Int         @id @default(autoincrement())
  admin_id    Int
  action      String      @db.VarChar(100)
  target_type String?     @db.VarChar(50)
  target_id   Int?
  details     Json?
  ip_address  String?     @db.Inet
  user_agent  String?
  created_at  DateTime?   @default(now()) @db.Timestamptz(6)
  admin_users admin_users @relation(fields: [admin_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([admin_id], map: "idx_admin_activity_logs_admin_id")
  @@index([created_at], map: "idx_admin_activity_logs_created_at")
}

model admin_users {
  id                  Int                   @id @default(autoincrement())
  user_id             Int
  role                String                @default("admin") @db.VarChar(50)
  permissions         Json?                 @default("[]")
  created_by          Int?
  created_at          DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?             @default(now()) @db.Timestamptz(6)
  admin_activity_logs admin_activity_logs[]
  admin_users         admin_users?          @relation("admin_usersToadmin_users", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_admin_users   admin_users[]         @relation("admin_usersToadmin_users")
  users               users                 @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  feature_flags       feature_flags[]
  moderation_queue    moderation_queue[]
  system_alerts       system_alerts[]

  @@index([role], map: "idx_admin_users_role")
  @@index([user_id], map: "idx_admin_users_user_id")
}

model content_comments {
  id                     Int                @id @default(autoincrement())
  user_id                Int
  content_id             Int
  parent_id              Int?
  comment                String
  created_at             DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?          @default(now()) @db.Timestamptz(6)
  content_items          content_items      @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  content_comments       content_comments?  @relation("content_commentsTocontent_comments", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_content_comments content_comments[] @relation("content_commentsTocontent_comments")
  users                  users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([content_id], map: "idx_content_comments_content_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model content_items {
  id                Int                @id @default(autoincrement())
  user_id           Int
  title             String             @db.VarChar(255)
  description       String?
  type              String             @db.VarChar(50)
  status            String             @default("draft") @db.VarChar(50)
  visibility        String             @default("private") @db.VarChar(50)
  file_url          String?
  thumbnail_url     String?
  duration          Int?
  file_size         BigInt?
  tags              String[]           @default([])
  category          String?            @db.VarChar(100)
  view_count        Int?               @default(0)
  like_count        Int?               @default(0)
  comment_count     Int?               @default(0)
  moderation_status String?            @db.VarChar(50)
  moderation_notes  String?
  created_at        DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?          @default(now()) @db.Timestamptz(6)
  published_at      DateTime?          @db.Timestamptz(6)
  content_comments  content_comments[]
  users             users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  content_likes     content_likes[]

  @@index([category], map: "idx_content_items_category")
  @@index([created_at(sort: Desc)], map: "idx_content_items_created_at")
  @@index([status], map: "idx_content_items_status")
  @@index([type], map: "idx_content_items_type")
  @@index([user_id], map: "idx_content_items_user_id")
}

model content_likes {
  id            Int           @id @default(autoincrement())
  user_id       Int
  content_id    Int
  created_at    DateTime?     @default(now()) @db.Timestamptz(6)
  content_items content_items @relation(fields: [content_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, content_id])
  @@index([content_id], map: "idx_content_likes_content_id")
}

model domain_verifications {
  id                  Int               @id @default(autoincrement())
  organization_id     Int
  domain              String            @db.VarChar(255)
  verification_token  String            @db.VarChar(255)
  verification_method String            @db.VarChar(20)
  verified_at         DateTime?         @db.Timestamp(6)
  expires_at          DateTime          @db.Timestamp(6)
  created_at          DateTime?         @default(now()) @db.Timestamp(6)
  is_verified         Boolean           @default(false)
  sso_organizations   sso_organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([organization_id, domain])
  @@index([domain], map: "idx_domain_verifications_domain")
}

model email_verification_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  token      String    @unique @db.VarChar(255)
  expires_at DateTime  @db.Timestamp(6)
  used       Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([token], map: "idx_email_verification_token")
  @@index([expires_at], map: "idx_email_verification_tokens_expires_at")
  @@index([token], map: "idx_email_verification_tokens_token")
  @@index([user_id], map: "idx_email_verification_tokens_user_id")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model exchange_rates {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  from_currency String    @db.VarChar(3)
  to_currency   String    @db.VarChar(3)
  rate          Decimal   @db.Decimal(20, 8)
  last_updated  DateTime? @default(now()) @db.Timestamptz(6)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([from_currency, to_currency])
  @@index([from_currency, to_currency], map: "idx_exchange_rates_currencies")
  @@index([last_updated(sort: Desc)], map: "idx_exchange_rates_updated")
}

model feature_flags {
  id                 Int          @id @default(autoincrement())
  flag_name          String       @unique @db.VarChar(100)
  description        String?
  is_enabled         Boolean?     @default(false)
  rollout_percentage Int?         @default(0)
  target_users       Json?        @default("[]")
  created_by         Int?
  created_at         DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?    @default(now()) @db.Timestamptz(6)
  admin_users        admin_users? @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model file_access_logs {
  id                Int           @id @default(autoincrement())
  file_id           String?       @db.Uuid
  user_id           String?       @db.VarChar(50)
  ip_address        String?       @db.Inet
  user_agent        String?
  referer           String?
  action            String        @db.VarChar(20)
  status_code       Int?
  bytes_transferred BigInt?
  created_at        DateTime?     @default(now()) @db.Timestamp(6)
  stored_files      stored_files? @relation(fields: [file_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_file_access_logs_created_at")
  @@index([file_id], map: "idx_file_access_logs_file_id")
}

model file_versions {
  id             String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  file_id        String?       @db.Uuid
  version_number Int
  stored_name    String        @db.VarChar(255)
  file_path      String        @db.VarChar(500)
  file_size      BigInt
  file_hash      String?       @db.VarChar(64)
  created_at     DateTime?     @default(now()) @db.Timestamp(6)
  stored_files   stored_files? @relation(fields: [file_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model invoices {
  id                   Int                    @id @default(autoincrement())
  user_id              Int
  subscription_id      Int?
  stripe_invoice_id    String?                @db.VarChar(255)
  invoice_number       String?                @db.VarChar(100)
  amount_due           Decimal                @db.Decimal(10, 2)
  amount_paid          Decimal?               @default(0) @db.Decimal(10, 2)
  currency             String?                @default("USD") @db.VarChar(3)
  status               String                 @db.VarChar(50)
  due_date             DateTime?              @db.Timestamptz(6)
  paid_at              DateTime?              @db.Timestamptz(6)
  invoice_pdf_url      String?
  description          String?
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  user_subscriptions   user_subscriptions?    @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                users                  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  payment_transactions payment_transactions[]

  @@index([status], map: "idx_invoices_status")
  @@index([user_id], map: "idx_invoices_user_id")
}

model ip_blacklist {
  id         Int       @id @default(autoincrement())
  ip_address String    @unique @db.Inet
  reason     String
  expires_at DateTime? @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)

  @@index([expires_at], map: "idx_ip_blacklist_expires")
  @@index([ip_address], map: "idx_ip_blacklist_ip")
}

model mobile_verifications {
  id           Int       @id @default(autoincrement())
  user_id      Int
  phone_number String    @db.VarChar(20)
  country_code String    @db.VarChar(5)
  is_verified  Boolean   @default(false)
  verified_at  DateTime? @db.Timestamp(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, phone_number])
  @@index([phone_number], map: "idx_mobile_verifications_phone")
  @@index([user_id], map: "idx_mobile_verifications_user_id")
}

model moderation_queue {
  id                                        Int          @id @default(autoincrement())
  content_type                              String       @db.VarChar(50)
  content_id                                Int
  user_id                                   Int
  reported_by                               Int?
  reason                                    String       @db.VarChar(100)
  status                                    String?      @default("pending") @db.VarChar(50)
  moderator_id                              Int?
  moderator_notes                           String?
  created_at                                DateTime?    @default(now()) @db.Timestamptz(6)
  updated_at                                DateTime?    @default(now()) @db.Timestamptz(6)
  admin_users                               admin_users? @relation(fields: [moderator_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_moderation_queue_reported_byTousers users?       @relation("moderation_queue_reported_byTousers", fields: [reported_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_moderation_queue_user_idTousers     users        @relation("moderation_queue_user_idTousers", fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at], map: "idx_moderation_queue_created_at")
  @@index([status], map: "idx_moderation_queue_status")
}

model notifications {
  id         Int       @id @default(autoincrement())
  user_id    Int
  type       String    @db.VarChar(50)
  title      String    @db.VarChar(255)
  message    String?
  metadata   Json?     @default("{}")
  read       Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(6)

  @@index([user_id], map: "idx_notifications_user_id")
}

model order_items {
  id         Int       @id @default(autoincrement())
  order_id   Int?
  product_id Int?
  name       String?
  quantity   Int
  price      Decimal   @db.Decimal
  orders     orders?   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products   products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([order_id], map: "idx_order_items_order")
}

model orders {
  id               Int           @id @default(autoincrement())
  user_id          Int?
  buyer_name       String?
  buyer_email      String?
  buyer_phone      String?
  shipping_address String?
  payment_method   String?       @db.VarChar
  status           String?       @default("pending") @db.VarChar
  total            Decimal?      @default(0) @db.Decimal
  created_at       DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?     @default(now()) @db.Timestamptz(6)
  order_items      order_items[]
  users            users?        @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([user_id], map: "idx_orders_user")
}

model otp_codes {
  id           Int       @id @default(autoincrement())
  user_id      Int?
  email        String?   @db.VarChar(255)
  phone_number String?   @db.VarChar(20)
  code         String    @db.VarChar(10)
  type         String    @db.VarChar(20)
  purpose      String    @db.VarChar(50)
  attempts     Int       @default(0)
  max_attempts Int       @default(3)
  expires_at   DateTime  @db.Timestamp(6)
  used_at      DateTime? @db.Timestamp(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  ip_address   String?   @db.Inet
  user_agent   String?
  is_active    Boolean   @default(true)
  users        users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([code], map: "idx_otp_codes_code")
  @@index([email], map: "idx_otp_codes_email")
  @@index([expires_at], map: "idx_otp_codes_expires_at")
  @@index([phone_number], map: "idx_otp_codes_phone")
  @@index([user_id], map: "idx_otp_codes_user_id")
}

model otp_rate_limits {
  id            Int       @id @default(autoincrement())
  identifier    String    @db.VarChar(255)
  type          String    @db.VarChar(20)
  attempts      Int       @default(1)
  window_start  DateTime? @default(now()) @db.Timestamp(6)
  blocked_until DateTime? @db.Timestamp(6)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)

  @@unique([identifier, type])
  @@index([identifier, type], map: "idx_otp_rate_limits_identifier")
}

model passkey_challenges {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  challenge  String
  type       String    @db.VarChar(20)
  expires_at DateTime  @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expires_at], map: "idx_passkey_challenges_expires_at")
  @@index([user_id], map: "idx_passkey_challenges_user_id")
}

model passkey_credentials {
  id              Int       @id @default(autoincrement())
  user_id         Int
  credential_id   String    @unique
  public_key      Bytes
  counter         BigInt    @default(0)
  device_type     String    @db.VarChar(50)
  backup_eligible Boolean   @default(false)
  backup_state    Boolean   @default(false)
  transports      String[]
  name            String?   @db.VarChar(255)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  last_used_at    DateTime? @db.Timestamp(6)
  is_active       Boolean   @default(true)
  users           users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([credential_id], map: "idx_passkey_credentials_credential_id")
  @@index([user_id], map: "idx_passkey_credentials_user_id")
}

model password_reset_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  token      String    @unique @db.VarChar(255)
  expires_at DateTime  @db.Timestamp(6)
  used       Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([token], map: "idx_password_reset_token")
}

model payment_methods {
  id                       Int                    @id @default(autoincrement())
  user_id                  Int
  stripe_payment_method_id String                 @db.VarChar(255)
  type                     String                 @db.VarChar(50)
  card_brand               String?                @db.VarChar(50)
  card_last4               String?                @db.VarChar(4)
  card_exp_month           Int?
  card_exp_year            Int?
  is_default               Boolean?               @default(false)
  created_at               DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?              @default(now()) @db.Timestamptz(6)
  users                    users                  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  payment_transactions     payment_transactions[]

  @@index([user_id], map: "idx_payment_methods_user_id")
}

model payment_transactions {
  id                       Int              @id @default(autoincrement())
  user_id                  Int
  invoice_id               Int?
  stripe_payment_intent_id String?          @db.VarChar(255)
  amount                   Decimal          @db.Decimal(10, 2)
  currency                 String?          @default("USD") @db.VarChar(3)
  status                   String           @db.VarChar(50)
  payment_method_id        Int?
  failure_reason           String?
  created_at               DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?        @default(now()) @db.Timestamptz(6)
  invoices                 invoices?        @relation(fields: [invoice_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  payment_methods          payment_methods? @relation(fields: [payment_method_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                    users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_payment_transactions_user_id")
}

model products {
  id          Int           @id @default(autoincrement())
  user_id     Int?
  name        String
  description String?
  price       Decimal       @db.Decimal
  stock       Int           @default(0)
  category    String?       @db.VarChar
  status      String?       @default("active") @db.VarChar
  rating      Decimal?      @default(0) @db.Decimal
  sales       Int?          @default(0)
  image       String?
  created_at  DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?     @default(now()) @db.Timestamptz(6)
  order_items order_items[]
  users       users?        @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([user_id], map: "idx_products_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model security_incidents {
  id          Int       @id @default(autoincrement())
  title       String    @db.VarChar(255)
  description String?
  severity    String    @db.VarChar(10)
  status      String?   @default("open") @db.VarChar(20)
  assigned_to Int?
  threat_ids  Json?     @default("[]")
  timeline    Json?     @default("[]")
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  users       users?    @relation(fields: [assigned_to], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model security_rules {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(255)
  description String?
  rule_type   String    @db.VarChar(50)
  conditions  Json
  actions     Json
  severity    String    @db.VarChar(10)
  enabled     Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([enabled], map: "idx_security_rules_enabled")
  @@index([rule_type], map: "idx_security_rules_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model security_threats {
  id                                           Int       @id @default(autoincrement())
  threat_type                                  String    @db.VarChar(50)
  severity                                     String    @db.VarChar(10)
  title                                        String    @db.VarChar(255)
  description                                  String?
  source_ip                                    String    @db.Inet
  target_user_id                               Int?
  indicators                                   Json?     @default("[]")
  status                                       String?   @default("active") @db.VarChar(20)
  first_detected                               DateTime? @default(now()) @db.Timestamptz(6)
  last_seen                                    DateTime? @default(now()) @db.Timestamptz(6)
  occurrences                                  Int?      @default(1)
  risk_score                                   Int?      @default(5)
  auto_resolved                                Boolean?  @default(false)
  resolved_by                                  Int?
  resolved_at                                  DateTime? @db.Timestamptz(6)
  metadata                                     Json?     @default("{}")
  created_at                                   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                                   DateTime? @default(now()) @db.Timestamptz(6)
  users_security_threats_resolved_byTousers    users?    @relation("security_threats_resolved_byTousers", fields: [resolved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_security_threats_target_user_idTousers users?    @relation("security_threats_target_user_idTousers", fields: [target_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([first_detected], map: "idx_security_threats_first_detected")
  @@index([risk_score], map: "idx_security_threats_risk_score")
  @@index([severity], map: "idx_security_threats_severity")
  @@index([source_ip], map: "idx_security_threats_source_ip")
  @@index([status], map: "idx_security_threats_status")
  @@index([target_user_id], map: "idx_security_threats_target_user")
  @@index([threat_type], map: "idx_security_threats_type")
}

model sso_login_attempts {
  id                Int                @id @default(autoincrement())
  organization_id   Int?
  provider_id       Int?
  user_id           Int?
  external_id       String?            @db.VarChar(255)
  email             String?            @db.VarChar(255)
  success           Boolean
  error_message     String?
  ip_address        String?            @db.Inet
  user_agent        String?
  created_at        DateTime?          @default(now()) @db.Timestamp(6)
  sso_organizations sso_organizations? @relation(fields: [organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sso_providers     sso_providers?     @relation(fields: [provider_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users             users?             @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([organization_id], map: "idx_sso_login_attempts_org_id")
}

model sso_organizations {
  id                                                 Int                    @id @default(autoincrement())
  name                                               String                 @db.VarChar(255)
  domain                                             String                 @unique @db.VarChar(255)
  slug                                               String                 @unique @db.VarChar(100)
  sso_enabled                                        Boolean                @default(false)
  auto_provision                                     Boolean                @default(true)
  default_role                                       String                 @default("user") @db.VarChar(50)
  created_at                                         DateTime?              @default(now()) @db.Timestamp(6)
  updated_at                                         DateTime?              @default(now()) @db.Timestamp(6)
  created_by                                         Int?
  is_active                                          Boolean                @default(true)
  domain_verifications                               domain_verifications[]
  sso_login_attempts                                 sso_login_attempts[]
  users_sso_organizations_created_byTousers          users?                 @relation("sso_organizations_created_byTousers", fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sso_providers                                      sso_providers[]
  sso_user_mappings                                  sso_user_mappings[]
  users_users_sso_organization_idTosso_organizations users[]                @relation("users_sso_organization_idTosso_organizations")

  @@index([domain], map: "idx_sso_organizations_domain")
  @@index([slug], map: "idx_sso_organizations_slug")
}

model sso_providers {
  id                       Int                  @id @default(autoincrement())
  organization_id          Int
  provider_type            String               @db.VarChar(20)
  provider_name            String               @db.VarChar(100)
  client_id                String?              @db.VarChar(255)
  client_secret            String?
  issuer_url               String?
  authorization_url        String?
  token_url                String?
  userinfo_url             String?
  jwks_uri                 String?
  saml_sso_url             String?
  saml_entity_id           String?
  saml_certificate         String?
  saml_signature_algorithm String?              @default("RSA-SHA256") @db.VarChar(50)
  attribute_mapping        Json?
  scopes                   String[]
  is_active                Boolean              @default(true)
  created_at               DateTime?            @default(now()) @db.Timestamp(6)
  updated_at               DateTime?            @default(now()) @db.Timestamp(6)
  sso_login_attempts       sso_login_attempts[]
  sso_organizations        sso_organizations    @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sso_user_mappings        sso_user_mappings[]

  @@unique([organization_id, provider_type])
  @@index([organization_id], map: "idx_sso_providers_org_id")
}

model sso_user_mappings {
  id                  Int               @id @default(autoincrement())
  user_id             Int
  organization_id     Int
  provider_id         Int
  external_id         String            @db.VarChar(255)
  external_email      String            @db.VarChar(255)
  external_attributes Json?
  last_login_at       DateTime?         @db.Timestamp(6)
  created_at          DateTime?         @default(now()) @db.Timestamp(6)
  updated_at          DateTime?         @default(now()) @db.Timestamp(6)
  sso_organizations   sso_organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sso_providers       sso_providers     @relation(fields: [provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users               users             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider_id, external_id])
  @@unique([user_id, organization_id])
  @@index([external_id], map: "idx_sso_user_mappings_external_id")
  @@index([organization_id], map: "idx_sso_user_mappings_org_id")
  @@index([user_id], map: "idx_sso_user_mappings_user_id")
}

model storage_buckets {
  id                Int                @id @default(autoincrement())
  provider_id       Int?
  name              String             @db.VarChar(100)
  region            String?            @db.VarChar(50)
  purpose           String             @db.VarChar(50)
  cdn_url           String?            @db.VarChar(255)
  is_public         Boolean?           @default(false)
  created_at        DateTime?          @default(now()) @db.Timestamp(6)
  updated_at        DateTime?          @default(now()) @db.Timestamp(6)
  storage_providers storage_providers? @relation(fields: [provider_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  stored_files      stored_files[]
}

model storage_providers {
  id              Int               @id @default(autoincrement())
  name            String            @unique @db.VarChar(50)
  type            String            @db.VarChar(20)
  config          Json
  is_active       Boolean?          @default(true)
  is_default      Boolean?          @default(false)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  updated_at      DateTime?         @default(now()) @db.Timestamp(6)
  storage_buckets storage_buckets[]
}

model storage_usage {
  id             Int       @id @default(autoincrement())
  user_id        String    @db.VarChar(50)
  date           DateTime  @db.Date
  total_files    Int?      @default(0)
  total_size     BigInt?   @default(0)
  bandwidth_used BigInt?   @default(0)
  requests_count Int?      @default(0)
  created_at     DateTime? @default(now()) @db.Timestamp(6)
  updated_at     DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, date])
  @@index([user_id, date], map: "idx_storage_usage_user_date")
}

model stored_files {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String             @db.VarChar(50)
  bucket_id         Int?
  original_name     String             @db.VarChar(255)
  stored_name       String             @db.VarChar(255)
  file_path         String             @db.VarChar(500)
  file_size         BigInt
  mime_type         String             @db.VarChar(100)
  file_hash         String?            @db.VarChar(64)
  metadata          Json?              @default("{}")
  tags              String[]
  is_public         Boolean?           @default(false)
  is_processed      Boolean?           @default(false)
  processing_status String?            @default("pending") @db.VarChar(20)
  cdn_url           String?            @db.VarChar(500)
  thumbnail_url     String?            @db.VarChar(500)
  expires_at        DateTime?          @db.Timestamp(6)
  created_at        DateTime?          @default(now()) @db.Timestamp(6)
  updated_at        DateTime?          @default(now()) @db.Timestamp(6)
  file_access_logs  file_access_logs[]
  file_versions     file_versions[]
  storage_buckets   storage_buckets?   @relation(fields: [bucket_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([bucket_id], map: "idx_stored_files_bucket_id")
  @@index([created_at], map: "idx_stored_files_created_at")
  @@index([mime_type], map: "idx_stored_files_mime_type")
  @@index([tags], map: "idx_stored_files_tags", type: Gin)
  @@index([user_id], map: "idx_stored_files_user_id")
}

model stream_analytics {
  id              Int       @id @default(autoincrement())
  stream_id       Int
  peak_viewers    Int?      @default(0)
  average_viewers Int?      @default(0)
  total_views     Int?      @default(0)
  chat_messages   Int?      @default(0)
  likes           Int?      @default(0)
  shares          Int?      @default(0)
  donations       Int?      @default(0)
  new_followers   Int?      @default(0)
  watch_time      Int?      @default(0)
  engagement      Decimal?  @default(0.00) @db.Decimal(3, 2)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  streams         streams   @relation(fields: [stream_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model stream_chat {
  id         Int       @id @default(autoincrement())
  stream_id  Int
  user_id    Int?
  username   String?   @db.VarChar(100)
  message    String
  type       String?   @default("message") @db.VarChar(20)
  metadata   Json?     @default("{}")
  created_at DateTime? @default(now()) @db.Timestamp(6)
  streams    streams   @relation(fields: [stream_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_stream_chat_created_at")
  @@index([stream_id], map: "idx_stream_chat_stream_id")
}

model stream_viewers {
  id         Int       @id @default(autoincrement())
  stream_id  Int
  user_id    Int?
  ip_address String?   @db.Inet
  user_agent String?
  joined_at  DateTime? @default(now()) @db.Timestamp(6)
  left_at    DateTime? @db.Timestamp(6)
  watch_time Int?      @default(0)
  streams    streams   @relation(fields: [stream_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([stream_id], map: "idx_stream_viewers_stream_id")
}

model streams {
  id                Int                @id @default(autoincrement())
  user_id           Int
  title             String             @db.VarChar(255)
  description       String?
  category          String?            @db.VarChar(100)
  tags              String[]
  thumbnail_url     String?
  privacy           String?            @default("public") @db.VarChar(20)
  chat_enabled      Boolean?           @default(true)
  recording_enabled Boolean?           @default(false)
  quality           String?            @default("1080p") @db.VarChar(10)
  bitrate           Int?               @default(2500)
  frame_rate        Int?               @default(30)
  audio_quality     String?            @default("high") @db.VarChar(20)
  scheduled_for     DateTime?          @db.Timestamp(6)
  max_duration      Int?
  stream_key        String             @unique @db.VarChar(255)
  rtmp_url          String
  hls_url           String?
  recording_url     String?
  status            String?            @default("idle") @db.VarChar(20)
  viewer_count      Int?               @default(0)
  duration          Int?               @default(0)
  start_time        DateTime?          @db.Timestamp(6)
  end_time          DateTime?          @db.Timestamp(6)
  created_at        DateTime?          @default(now()) @db.Timestamp(6)
  updated_at        DateTime?          @default(now()) @db.Timestamp(6)
  stream_analytics  stream_analytics[]
  stream_chat       stream_chat[]
  stream_viewers    stream_viewers[]

  @@index([created_at], map: "idx_streams_created_at")
  @@index([status], map: "idx_streams_status")
  @@index([user_id], map: "idx_streams_user_id")
}

model subscription_plans {
  id                 Int                  @id @default(autoincrement())
  name               String               @db.VarChar(100)
  description        String?
  price_monthly      Decimal              @db.Decimal(10, 2)
  price_yearly       Decimal?             @db.Decimal(10, 2)
  features           Json?                @default("[]")
  limits             Json?                @default("{}")
  is_active          Boolean?             @default(true)
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  user_subscriptions user_subscriptions[]
}

model system_alerts {
  id          Int          @id @default(autoincrement())
  alert_type  String       @db.VarChar(50)
  title       String       @db.VarChar(255)
  message     String
  severity    Int?         @default(1)
  is_resolved Boolean?     @default(false)
  resolved_by Int?
  resolved_at DateTime?    @db.Timestamptz(6)
  created_at  DateTime?    @default(now()) @db.Timestamptz(6)
  admin_users admin_users? @relation(fields: [resolved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([alert_type], map: "idx_system_alerts_alert_type")
  @@index([is_resolved], map: "idx_system_alerts_is_resolved")
}

model system_metrics {
  id           Int       @id @default(autoincrement())
  metric_name  String    @db.VarChar(100)
  metric_value Decimal   @db.Decimal(15, 2)
  metric_unit  String?   @db.VarChar(50)
  category     String    @db.VarChar(50)
  recorded_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([category], map: "idx_system_metrics_category")
  @@index([recorded_at], map: "idx_system_metrics_recorded_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model system_settings {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key         String    @unique @db.VarChar(100)
  value       String
  description String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([key], map: "idx_system_settings_key")
}

model usage_tracking {
  id           Int       @id @default(autoincrement())
  user_id      Int
  metric_name  String    @db.VarChar(100)
  metric_value Decimal   @db.Decimal(15, 2)
  period_start DateTime  @db.Timestamptz(6)
  period_end   DateTime  @db.Timestamptz(6)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([period_start, period_end], map: "idx_usage_tracking_period")
  @@index([user_id], map: "idx_usage_tracking_user_id")
}

model user_2fa_backup_codes {
  id         Int       @id @default(autoincrement())
  user_id    Int
  code       String    @db.VarChar(10)
  used_at    DateTime? @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  is_active  Boolean   @default(true)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([code], map: "idx_user_2fa_backup_codes_code")
  @@index([user_id], map: "idx_user_2fa_backup_codes_user_id")
}

model user_2fa_recovery_attempts {
  id           Int       @id @default(autoincrement())
  user_id      Int
  attempt_type String    @db.VarChar(20)
  success      Boolean
  ip_address   String?   @db.Inet
  user_agent   String?
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_2fa_recovery_attempts_user_id")
}

model user_2fa_settings {
  id                        Int       @id @default(autoincrement())
  user_id                   Int       @unique
  is_enabled                Boolean   @default(false)
  totp_secret               String?   @db.VarChar(32)
  totp_enabled              Boolean   @default(false)
  sms_enabled               Boolean   @default(false)
  email_enabled             Boolean   @default(false)
  backup_codes_generated_at DateTime? @db.Timestamp(6)
  backup_codes_used         Int       @default(0)
  created_at                DateTime? @default(now()) @db.Timestamp(6)
  updated_at                DateTime? @default(now()) @db.Timestamp(6)
  users                     users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_2fa_settings_user_id")
}

model user_activity {
  id            Int       @id @default(autoincrement())
  user_id       Int
  action        String    @db.VarChar(255)
  resource_type String?   @db.VarChar(100)
  resource_id   String?   @db.VarChar(255)
  metadata      Json?     @default("{}")
  ip_address    String?   @db.Inet
  user_agent    String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_user_activity_created_at")
  @@index([user_id], map: "idx_user_activity_user_id")
}

model user_followers {
  id          Int       @id @default(autoincrement())
  user_id     Int
  follower_id Int
  created_at  DateTime? @default(now()) @db.Timestamp(6)

  @@unique([user_id, follower_id])
  @@index([follower_id], map: "idx_user_followers_follower_id")
  @@index([user_id], map: "idx_user_followers_user_id")
}

model user_sessions {
  id            Int       @id @default(autoincrement())
  user_id       Int?
  session_token String    @unique @db.VarChar(255)
  expires_at    DateTime  @db.Timestamp(6)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  users         users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_token], map: "idx_sessions_token")
}

model user_subscriptions {
  id                     Int                @id @default(autoincrement())
  user_id                Int
  plan_id                Int
  status                 String             @default("active") @db.VarChar(50)
  billing_cycle          String             @default("monthly") @db.VarChar(20)
  current_period_start   DateTime           @db.Timestamptz(6)
  current_period_end     DateTime           @db.Timestamptz(6)
  cancel_at_period_end   Boolean?           @default(false)
  canceled_at            DateTime?          @db.Timestamptz(6)
  stripe_subscription_id String?            @db.VarChar(255)
  created_at             DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?          @default(now()) @db.Timestamptz(6)
  invoices               invoices[]
  subscription_plans     subscription_plans @relation(fields: [plan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                  users              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_user_subscriptions_status")
  @@index([user_id], map: "idx_user_subscriptions_user_id")
}

model users {
  id                                                             Int                          @id @default(autoincrement())
  email                                                          String                       @unique @db.VarChar(255)
  name                                                           String?                      @db.VarChar(255)
  password_hash                                                  String?                      @db.VarChar(255)
  avatar_url                                                     String?
  provider                                                       String?                      @db.VarChar(50)
  provider_id                                                    String?                      @db.VarChar(255)
  role                                                           String?                      @default("user") @db.VarChar(50)
  email_verified                                                 Boolean?                     @default(false)
  created_at                                                     DateTime?                    @default(now()) @db.Timestamp(6)
  updated_at                                                     DateTime?                    @default(now()) @db.Timestamp(6)
  email_verified_at                                              DateTime?                    @db.Timestamptz(6)
  pending_email                                                  String?                      @db.VarChar(255)
  username                                                       String?                      @unique @db.VarChar(100)
  bio                                                            String?
  website                                                        String?                      @db.VarChar(255)
  location                                                       String?                      @db.VarChar(255)
  two_factor_enabled                                             Boolean                      @default(false)
  two_factor_backup_at                                           DateTime?                    @db.Timestamp(6)
  sso_organization_id                                            Int?
  is_sso_user                                                    Boolean                      @default(false)
  admin_users                                                    admin_users[]
  content_comments                                               content_comments[]
  content_items                                                  content_items[]
  content_likes                                                  content_likes[]
  email_verification_tokens                                      email_verification_tokens[]
  invoices                                                       invoices[]
  mobile_verifications                                           mobile_verifications[]
  moderation_queue_moderation_queue_reported_byTousers           moderation_queue[]           @relation("moderation_queue_reported_byTousers")
  moderation_queue_moderation_queue_user_idTousers               moderation_queue[]           @relation("moderation_queue_user_idTousers")
  orders                                                         orders[]
  otp_codes                                                      otp_codes[]
  passkey_challenges                                             passkey_challenges[]
  passkey_credentials                                            passkey_credentials[]
  password_reset_tokens                                          password_reset_tokens[]
  payment_methods                                                payment_methods[]
  payment_transactions                                           payment_transactions[]
  products                                                       products[]
  security_incidents                                             security_incidents[]
  security_threats_security_threats_resolved_byTousers           security_threats[]           @relation("security_threats_resolved_byTousers")
  security_threats_security_threats_target_user_idTousers        security_threats[]           @relation("security_threats_target_user_idTousers")
  sso_login_attempts                                             sso_login_attempts[]
  sso_organizations_sso_organizations_created_byTousers          sso_organizations[]          @relation("sso_organizations_created_byTousers")
  sso_user_mappings                                              sso_user_mappings[]
  usage_tracking                                                 usage_tracking[]
  user_2fa_backup_codes                                          user_2fa_backup_codes[]
  user_2fa_recovery_attempts                                     user_2fa_recovery_attempts[]
  user_2fa_settings                                              user_2fa_settings?
  user_activity                                                  user_activity[]
  user_sessions                                                  user_sessions[]
  user_subscriptions                                             user_subscriptions[]
  sso_organizations_users_sso_organization_idTosso_organizations sso_organizations?           @relation("users_sso_organization_idTosso_organizations", fields: [sso_organization_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([email], map: "idx_users_email")
  @@index([email_verified], map: "idx_users_email_verified")
  @@index([username], map: "idx_users_username")
}
