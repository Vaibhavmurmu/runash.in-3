;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="2ea77ee6-d627-4a88-bbb4-10ecc1fe5f03")}catch(e){}}();
module.exports=[66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},13601,(a,b,c)=>{"use strict";var d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.prototype.hasOwnProperty,h={},i={Analytics:()=>n};for(var j in i)d(h,j,{get:i[j],enumerable:!0});b.exports=((a,b,c,h)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let i of f(b))g.call(a,i)||i===c||d(a,i,{get:()=>b[i],enumerable:!(h=e(b,i))||h.enumerable});return a})(d({},"__esModule",{value:!0}),h);var k=`
local key = KEYS[1]
local field = ARGV[1]

local data = redis.call("ZRANGE", key, 0, -1, "WITHSCORES")
local count = {}

for i = 1, #data, 2 do
  local json_str = data[i]
  local score = tonumber(data[i + 1])
  local obj = cjson.decode(json_str)

  local fieldValue = obj[field]

  if count[fieldValue] == nil then
    count[fieldValue] = score
  else
    count[fieldValue] = count[fieldValue] + score
  end
end

local result = {}
for k, v in pairs(count) do
  table.insert(result, {k, v})
end

return result
`,l=`
local prefix = KEYS[1]
local first_timestamp = tonumber(ARGV[1]) -- First timestamp to check
local increment = tonumber(ARGV[2])       -- Increment between each timestamp
local num_timestamps = tonumber(ARGV[3])  -- Number of timestampts to check (24 for a day and 24 * 7 for a week)
local num_elements = tonumber(ARGV[4])    -- Number of elements to fetch in each category
local check_at_most = tonumber(ARGV[5])   -- Number of elements to check at most.

local keys = {}
for i = 1, num_timestamps do
  local timestamp = first_timestamp - (i - 1) * increment
  table.insert(keys, prefix .. ":" .. timestamp)
end

-- get the union of the groups
local zunion_params = {"ZUNION", num_timestamps, unpack(keys)}
table.insert(zunion_params, "WITHSCORES")
local result = redis.call(unpack(zunion_params))

-- select num_elements many items
local true_group = {}
local false_group = {}
local denied_group = {}
local true_count = 0
local false_count = 0
local denied_count = 0
local i = #result - 1

-- index to stop at after going through "checkAtMost" many items:
local cutoff_index = #result - 2 * check_at_most

-- iterate over the results
while (true_count + false_count + denied_count) < (num_elements * 3) and 1 <= i and i >= cutoff_index do
  local score = tonumber(result[i + 1])
  if score > 0 then
    local element = result[i]
    if string.find(element, "success\\":true") and true_count < num_elements then
      table.insert(true_group, {score, element})
      true_count = true_count + 1
    elseif string.find(element, "success\\":false") and false_count < num_elements then
      table.insert(false_group, {score, element})
      false_count = false_count + 1
    elseif string.find(element, "success\\":\\"denied") and denied_count < num_elements then
      table.insert(denied_group, {score, element})
      denied_count = denied_count + 1
    end
  end
  i = i - 2
end

return {true_group, false_group, denied_group}
`,m=`
local prefix = KEYS[1]
local first_timestamp = tonumber(ARGV[1])
local increment = tonumber(ARGV[2])
local num_timestamps = tonumber(ARGV[3])

local keys = {}
for i = 1, num_timestamps do
  local timestamp = first_timestamp - (i - 1) * increment
  table.insert(keys, prefix .. ":" .. timestamp)
end

-- get the union of the groups
local zunion_params = {"ZUNION", num_timestamps, unpack(keys)}
table.insert(zunion_params, "WITHSCORES")
local result = redis.call(unpack(zunion_params))

return result
`,n=class{redis;prefix;bucketSize;constructor(a){this.redis=a.redis,this.prefix=a.prefix??"@upstash/analytics",this.bucketSize=this.parseWindow(a.window)}validateTableName(a){if(!/^[a-zA-Z0-9_-]+$/.test(a))throw Error(`Invalid table name: ${a}. Table names can only contain letters, numbers, dashes and underscores.`)}parseWindow(a){if("number"==typeof a){if(a<=0)throw Error(`Invalid window: ${a}`);return a}let b=/^(\d+)([smhd])$/;if(!b.test(a))throw Error(`Invalid window: ${a}`);let[,c,d]=a.match(b),e=parseInt(c);switch(d){case"s":return 1e3*e;case"m":return 1e3*e*60;case"h":return 1e3*e*3600;case"d":return 1e3*e*86400;default:throw Error(`Invalid window unit: ${d}`)}}getBucket(a){return Math.floor((a??Date.now())/this.bucketSize)*this.bucketSize}async ingest(a,...b){this.validateTableName(a),await Promise.all(b.map(async b=>{let c=this.getBucket(b.time),d=[this.prefix,a,c].join(":");await this.redis.zincrby(d,1,JSON.stringify({...b,time:void 0}))}))}formatBucketAggregate(a,b,c){let d={};return a.forEach(([a,c])=>{"success"==b&&(a=1===a?"true":null===a?"false":a),d[b]=d[b]||{},d[b][(a??"null").toString()]=c}),{time:c,...d}}async aggregateBucket(a,b,c){this.validateTableName(a);let d=this.getBucket(c),e=[this.prefix,a,d].join(":"),f=await this.redis.eval(k,[e],[b]);return this.formatBucketAggregate(f,b,d)}async aggregateBuckets(a,b,c,d){this.validateTableName(a);let e=this.getBucket(d),f=[];for(let d=0;d<c;d+=1)f.push(this.aggregateBucket(a,b,e)),e-=this.bucketSize;return Promise.all(f)}async aggregateBucketsWithPipeline(a,b,c,d,e){this.validateTableName(a),e=e??48;let f=this.getBucket(d),g=[],h=this.redis.pipeline(),i=[];for(let d=1;d<=c;d+=1){let j=[this.prefix,a,f].join(":");h.eval(k,[j],[b]),g.push(f),f-=this.bucketSize,(d%e==0||d==c)&&(i.push(h.exec()),h=this.redis.pipeline())}return(await Promise.all(i)).flat().map((a,c)=>this.formatBucketAggregate(a,b,g[c]))}async getAllowedBlocked(a,b,c){this.validateTableName(a);let d=[this.prefix,a].join(":"),e=this.getBucket(c),f=await this.redis.eval(m,[d],[e,this.bucketSize,b]),g={};for(let a=0;a<f.length;a+=2){let b=f[a],c=b.identifier,d=+f[a+1];g[c]||(g[c]={success:0,blocked:0}),g[c][b.success?"success":"blocked"]=d}return g}async getMostAllowedBlocked(a,b,c,d,e){this.validateTableName(a);let f=[this.prefix,a].join(":"),g=this.getBucket(d),[h,i,j]=await this.redis.eval(l,[f],[g,this.bucketSize,b,c,e??5*c]);return{allowed:this.toDicts(h),ratelimited:this.toDicts(i),denied:this.toDicts(j)}}toDicts(a){let b=[];for(let c=0;c<a.length;c+=1){let d=+a[c][0],e=a[c][1];b.push({identifier:e.identifier,count:d})}return b}}},5324,(a,b,c)=>{"use strict";var d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.prototype.hasOwnProperty,h=(a,b)=>{for(var c in b)d(a,c,{get:b[c],enumerable:!0})},i={};h(i,{Analytics:()=>k,IpDenyList:()=>v,MultiRegionRatelimit:()=>E,Ratelimit:()=>F}),b.exports=((a,b,c,h)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let i of f(b))g.call(a,i)||i===c||d(a,i,{get:()=>b[i],enumerable:!(h=e(b,i))||h.enumerable});return a})(d({},"__esModule",{value:!0}),i);var j=a.r(13601),k=class{analytics;table="events";constructor(a){this.analytics=new j.Analytics({redis:a.redis,window:"1h",prefix:a.prefix??"@upstash/ratelimit",retention:"90d"})}extractGeo(a){return void 0!==a.geo?a.geo:void 0!==a.cf?a.cf:{}}async record(a){await this.analytics.ingest(this.table,a)}async series(a,b){let c=Math.min((this.analytics.getBucket(Date.now())-this.analytics.getBucket(b))/36e5,256);return this.analytics.aggregateBucketsWithPipeline(this.table,a,c)}async getUsage(a=0){let b=Math.min((this.analytics.getBucket(Date.now())-this.analytics.getBucket(a))/36e5,256);return await this.analytics.getAllowedBlocked(this.table,b)}async getUsageOverTime(a,b){return await this.analytics.aggregateBucketsWithPipeline(this.table,b,a)}async getMostAllowedBlocked(a,b,c){return b=b??5,this.analytics.getMostAllowedBlocked(this.table,a,b,void 0,c)}},l=class{cache;constructor(a){this.cache=a}isBlocked(a){if(!this.cache.has(a))return{blocked:!1,reset:0};let b=this.cache.get(a);return b<Date.now()?(this.cache.delete(a),{blocked:!1,reset:0}):{blocked:!0,reset:b}}blockUntil(a,b){this.cache.set(a,b)}set(a,b){this.cache.set(a,b)}get(a){return this.cache.get(a)||null}incr(a,b=1){let c=this.cache.get(a)??0;return c+=b,this.cache.set(a,c),c}pop(a){this.cache.delete(a)}empty(){this.cache.clear()}size(){return this.cache.size}};function m(a){let b=a.match(/^(\d+)\s?(ms|s|m|h|d)$/);if(!b)throw Error(`Unable to parse window size: ${a}`);let c=Number.parseInt(b[1]);switch(b[2]){case"ms":return c;case"s":return 1e3*c;case"m":return 1e3*c*60;case"h":return 1e3*c*3600;case"d":return 1e3*c*86400;default:throw Error(`Unable to parse window size: ${a}`)}}var n=async(a,b,c,d)=>{try{return await a.redis.evalsha(b.hash,c,d)}catch(e){if(`${e}`.includes("NOSCRIPT"))return await a.redis.eval(b.script,c,d);throw e}},o={fixedWindow:{limit:{script:`
  local key           = KEYS[1]
  local window        = ARGV[1]
  local incrementBy   = ARGV[2] -- increment rate per request at a given value, default is 1

  local r = redis.call("INCRBY", key, incrementBy)
  if r == tonumber(incrementBy) then
  -- The first time this key is set, the value will be equal to incrementBy.
  -- So we only need the expire command once
  redis.call("PEXPIRE", key, window)
  end

  return r
`,hash:"b13943e359636db027ad280f1def143f02158c13"},getRemaining:{script:`
      local key = KEYS[1]
      local tokens = 0

      local value = redis.call('GET', key)
      if value then
          tokens = value
      end
      return tokens
    `,hash:"8c4c341934502aee132643ffbe58ead3450e5208"}},slidingWindow:{limit:{script:`
  local currentKey  = KEYS[1]           -- identifier including prefixes
  local previousKey = KEYS[2]           -- key of the previous bucket
  local tokens      = tonumber(ARGV[1]) -- tokens per window
  local now         = ARGV[2]           -- current timestamp in milliseconds
  local window      = ARGV[3]           -- interval in milliseconds
  local incrementBy = tonumber(ARGV[4]) -- increment rate per request at a given value, default is 1

  local requestsInCurrentWindow = redis.call("GET", currentKey)
  if requestsInCurrentWindow == false then
    requestsInCurrentWindow = 0
  end

  local requestsInPreviousWindow = redis.call("GET", previousKey)
  if requestsInPreviousWindow == false then
    requestsInPreviousWindow = 0
  end
  local percentageInCurrent = ( now % window ) / window
  -- weighted requests to consider from the previous window
  requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)

  -- Only check limit if not refunding (negative rate)
  if incrementBy > 0 and requestsInPreviousWindow + requestsInCurrentWindow >= tokens then
    return -1
  end

  local newValue = redis.call("INCRBY", currentKey, incrementBy)
  if newValue == incrementBy then
    -- The first time this key is set, the value will be equal to incrementBy.
    -- So we only need the expire command once
    redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
  end
  return tokens - ( newValue + requestsInPreviousWindow )
`,hash:"9b7842963bd73721f1a3011650c23c0010848ee3"},getRemaining:{script:`
  local currentKey  = KEYS[1]           -- identifier including prefixes
  local previousKey = KEYS[2]           -- key of the previous bucket
  local now         = ARGV[1]           -- current timestamp in milliseconds
  local window      = ARGV[2]           -- interval in milliseconds

  local requestsInCurrentWindow = redis.call("GET", currentKey)
  if requestsInCurrentWindow == false then
    requestsInCurrentWindow = 0
  end

  local requestsInPreviousWindow = redis.call("GET", previousKey)
  if requestsInPreviousWindow == false then
    requestsInPreviousWindow = 0
  end

  local percentageInCurrent = ( now % window ) / window
  -- weighted requests to consider from the previous window
  requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)

  return requestsInPreviousWindow + requestsInCurrentWindow
`,hash:"65a73ac5a05bf9712903bc304b77268980c1c417"}},tokenBucket:{limit:{script:`
  local key         = KEYS[1]           -- identifier including prefixes
  local maxTokens   = tonumber(ARGV[1]) -- maximum number of tokens
  local interval    = tonumber(ARGV[2]) -- size of the window in milliseconds
  local refillRate  = tonumber(ARGV[3]) -- how many tokens are refilled after each interval
  local now         = tonumber(ARGV[4]) -- current timestamp in milliseconds
  local incrementBy = tonumber(ARGV[5]) -- how many tokens to consume, default is 1
        
  local bucket = redis.call("HMGET", key, "refilledAt", "tokens")
        
  local refilledAt
  local tokens

  if bucket[1] == false then
    refilledAt = now
    tokens = maxTokens
  else
    refilledAt = tonumber(bucket[1])
    tokens = tonumber(bucket[2])
  end
        
  if now >= refilledAt + interval then
    local numRefills = math.floor((now - refilledAt) / interval)
    tokens = math.min(maxTokens, tokens + numRefills * refillRate)

    refilledAt = refilledAt + numRefills * interval
  end

  -- Only reject if tokens are 0 and we're consuming (not refunding)
  if tokens == 0 and incrementBy > 0 then
    return {-1, refilledAt + interval}
  end

  local remaining = tokens - incrementBy
  local expireAt = math.ceil(((maxTokens - remaining) / refillRate)) * interval
        
  redis.call("HSET", key, "refilledAt", refilledAt, "tokens", remaining)

  if (expireAt > 0) then
    redis.call("PEXPIRE", key, expireAt)
  end
  return {remaining, refilledAt + interval}
`,hash:"d1f857ebbdaeca90ccd2cd4eada61d7c8e5db1ca"},getRemaining:{script:`
  local key         = KEYS[1]
  local maxTokens   = tonumber(ARGV[1])
        
  local bucket = redis.call("HMGET", key, "refilledAt", "tokens")

  if bucket[1] == false then
    return {maxTokens, -1}
  end
        
  return {tonumber(bucket[2]), tonumber(bucket[1])}
`,hash:"a15be2bb1db2a15f7c82db06146f9d08983900d0"}},cachedFixedWindow:{limit:{script:`
  local key     = KEYS[1]
  local window  = ARGV[1]
  local incrementBy   = ARGV[2] -- increment rate per request at a given value, default is 1

  local r = redis.call("INCRBY", key, incrementBy)
  if r == incrementBy then
  -- The first time this key is set, the value will be equal to incrementBy.
  -- So we only need the expire command once
  redis.call("PEXPIRE", key, window)
  end
      
  return r
`,hash:"c26b12703dd137939b9a69a3a9b18e906a2d940f"},getRemaining:{script:`
  local key = KEYS[1]
  local tokens = 0

  local value = redis.call('GET', key)
  if value then
      tokens = value
  end
  return tokens
`,hash:"8e8f222ccae68b595ee6e3f3bf2199629a62b91a"}}},p={fixedWindow:{limit:{script:`
	local key           = KEYS[1]
	local id            = ARGV[1]
	local window        = ARGV[2]
	local incrementBy   = tonumber(ARGV[3])

	redis.call("HSET", key, id, incrementBy)
	local fields = redis.call("HGETALL", key)
	if #fields == 2 and tonumber(fields[2])==incrementBy then
	-- The first time this key is set, and the value will be equal to incrementBy.
	-- So we only need the expire command once
	  redis.call("PEXPIRE", key, window)
	end

	return fields
`,hash:"a8c14f3835aa87bd70e5e2116081b81664abcf5c"},getRemaining:{script:`
      local key = KEYS[1]
      local tokens = 0

      local fields = redis.call("HGETALL", key)

      return fields
    `,hash:"8ab8322d0ed5fe5ac8eb08f0c2e4557f1b4816fd"}},slidingWindow:{limit:{script:`
	local currentKey    = KEYS[1]           -- identifier including prefixes
	local previousKey   = KEYS[2]           -- key of the previous bucket
	local tokens        = tonumber(ARGV[1]) -- tokens per window
	local now           = ARGV[2]           -- current timestamp in milliseconds
	local window        = ARGV[3]           -- interval in milliseconds
	local requestId     = ARGV[4]           -- uuid for this request
	local incrementBy   = tonumber(ARGV[5]) -- custom rate, default is  1

	local currentFields = redis.call("HGETALL", currentKey)
	local requestsInCurrentWindow = 0
	for i = 2, #currentFields, 2 do
	requestsInCurrentWindow = requestsInCurrentWindow + tonumber(currentFields[i])
	end

	local previousFields = redis.call("HGETALL", previousKey)
	local requestsInPreviousWindow = 0
	for i = 2, #previousFields, 2 do
	requestsInPreviousWindow = requestsInPreviousWindow + tonumber(previousFields[i])
	end

	local percentageInCurrent = ( now % window) / window

	-- Only check limit if not refunding (negative rate)
	if incrementBy > 0 and requestsInPreviousWindow * (1 - percentageInCurrent ) + requestsInCurrentWindow + incrementBy > tokens then
	  return {currentFields, previousFields, false}
	end

	redis.call("HSET", currentKey, requestId, incrementBy)

	if requestsInCurrentWindow == 0 then 
	  -- The first time this key is set, the value will be equal to incrementBy.
	  -- So we only need the expire command once
	  redis.call("PEXPIRE", currentKey, window * 2 + 1000) -- Enough time to overlap with a new window + 1 second
	end
	return {currentFields, previousFields, true}
`,hash:"1e7ca8dcd2d600a6d0124a67a57ea225ed62921b"},getRemaining:{script:`
	local currentKey    = KEYS[1]           -- identifier including prefixes
	local previousKey   = KEYS[2]           -- key of the previous bucket
	local now         	= ARGV[1]           -- current timestamp in milliseconds
  	local window      	= ARGV[2]           -- interval in milliseconds

	local currentFields = redis.call("HGETALL", currentKey)
	local requestsInCurrentWindow = 0
	for i = 2, #currentFields, 2 do
	requestsInCurrentWindow = requestsInCurrentWindow + tonumber(currentFields[i])
	end

	local previousFields = redis.call("HGETALL", previousKey)
	local requestsInPreviousWindow = 0
	for i = 2, #previousFields, 2 do
	requestsInPreviousWindow = requestsInPreviousWindow + tonumber(previousFields[i])
	end

	local percentageInCurrent = ( now % window) / window
  	requestsInPreviousWindow = math.floor(( 1 - percentageInCurrent ) * requestsInPreviousWindow)
	
	return requestsInCurrentWindow + requestsInPreviousWindow
`,hash:"558c9306b7ec54abb50747fe0b17e5d44bd24868"}}},q={script:`
      local pattern = KEYS[1]

      -- Initialize cursor to start from 0
      local cursor = "0"

      repeat
          -- Scan for keys matching the pattern
          local scan_result = redis.call('SCAN', cursor, 'MATCH', pattern)

          -- Extract cursor for the next iteration
          cursor = scan_result[1]

          -- Extract keys from the scan result
          local keys = scan_result[2]

          for i=1, #keys do
          redis.call('DEL', keys[i])
          end

      -- Continue scanning until cursor is 0 (end of keyspace)
      until cursor == "0"
    `,hash:"54bd274ddc59fb3be0f42deee2f64322a10e2b50"},r="denyList",s="ipDenyList",t="ipDenyListStatus",u=`
  -- Checks if values provideed in ARGV are present in the deny lists.
  -- This is done using the allDenyListsKey below.

  -- Additionally, checks the status of the ip deny list using the
  -- ipDenyListStatusKey below. Here are the possible states of the
  -- ipDenyListStatusKey key:
  -- * status == -1: set to "disabled" with no TTL
  -- * status == -2: not set, meaning that is was set before but expired
  -- * status  >  0: set to "valid", with a TTL
  --
  -- In the case of status == -2, we set the status to "pending" with
  -- 30 second ttl. During this time, the process which got status == -2
  -- will update the ip deny list.

  local allDenyListsKey     = KEYS[1]
  local ipDenyListStatusKey = KEYS[2]

  local results = redis.call('SMISMEMBER', allDenyListsKey, unpack(ARGV))
  local status  = redis.call('TTL', ipDenyListStatusKey)
  if status == -2 then
    redis.call('SETEX', ipDenyListStatusKey, 30, "pending")
  end

  return { results, status }
`,v={};h(v,{ThresholdError:()=>w,disableIpDenyList:()=>z,updateIpDenyList:()=>y});var w=class extends Error{constructor(a){super(`Allowed threshold values are from 1 to 8, 1 and 8 included. Received: ${a}`),this.name="ThresholdError"}},x=async a=>{if("number"!=typeof a||a<1||a>8)throw new w(a);try{let b=await fetch(`https://raw.githubusercontent.com/stamparm/ipsum/master/levels/${a}.txt`);if(!b.ok)throw Error(`Error fetching data: ${b.statusText}`);return(await b.text()).split("\n").filter(a=>a.length>0)}catch(a){throw Error(`Failed to fetch ip deny list: ${a}`)}},y=async(a,b,c,d)=>{var e;let f=await x(c),g=[b,r,"all"].join(":"),h=[b,r,s].join(":"),i=[b,t].join(":"),j=a.multi();return j.sdiffstore(g,g,h),j.del(h),j.sadd(h,f.at(0),...f.slice(1)),j.sdiffstore(h,h,g),j.sunionstore(g,g,h),j.set(i,"valid",{px:d??864e5-((e||Date.now())-72e5)%864e5}),await j.exec()},z=async(a,b)=>{let c=[b,r,"all"].join(":"),d=[b,r,s].join(":"),e=[b,t].join(":"),f=a.multi();return f.sdiffstore(c,c,d),f.del(d),f.set(e,"disabled"),await f.exec()},A=new l(new Map),B=async(a,b,c)=>{let d,[e,f]=await a.eval(u,[[b,r,"all"].join(":"),[b,t].join(":")],c);return e.map((a,b)=>{if(a){var e;e=c[b],A.size()>1e3&&A.empty(),A.blockUntil(e,Date.now()+6e4),d=c[b]}}),{deniedValue:d,invalidIpDenyList:-2===f}},C=class{limiter;ctx;prefix;timeout;primaryRedis;analytics;enableProtection;denyListThreshold;constructor(a){this.ctx=a.ctx,this.limiter=a.limiter,this.timeout=a.timeout??5e3,this.prefix=a.prefix??"@upstash/ratelimit",this.enableProtection=a.enableProtection??!1,this.denyListThreshold=a.denyListThreshold??6,this.primaryRedis="redis"in this.ctx?this.ctx.redis:this.ctx.regionContexts[0].redis,this.analytics=a.analytics?new k({redis:this.primaryRedis,prefix:this.prefix}):void 0,a.ephemeralCache instanceof Map?this.ctx.cache=new l(a.ephemeralCache):void 0===a.ephemeralCache&&(this.ctx.cache=new l(new Map))}limit=async(a,b)=>{let c=null;try{let d=this.getRatelimitResponse(a,b),{responseArray:e,newTimeoutId:f}=this.applyTimeout(d);c=f;let g=await Promise.race(e);return this.submitAnalytics(g,a,b)}finally{c&&clearTimeout(c)}};blockUntilReady=async(a,b)=>{let c;if(b<=0)throw Error("timeout must be positive");let d=Date.now()+b;for(;!(c=await this.limit(a)).success;){if(0===c.reset)throw Error("This should not happen");let a=Math.min(c.reset,d)-Date.now();if(await new Promise(b=>setTimeout(b,a)),Date.now()>d)break}return c};resetUsedTokens=async a=>{let b=[this.prefix,a].join(":");await this.limiter().resetTokens(this.ctx,b)};getRemaining=async a=>{let b=[this.prefix,a].join(":");return await this.limiter().getRemaining(this.ctx,b)};getRatelimitResponse=async(a,b)=>{let c=this.getKey(a),d=this.getDefinedMembers(a,b),e=d.find(a=>A.isBlocked(a).blocked),f=e?[{success:!1,limit:0,remaining:0,reset:0,pending:Promise.resolve(),reason:"denyList",deniedValue:e},{deniedValue:e,invalidIpDenyList:!1}]:await Promise.all([this.limiter().limit(this.ctx,c,b?.rate),this.enableProtection?B(this.primaryRedis,this.prefix,d):{deniedValue:void 0,invalidIpDenyList:!1}]);return((a,b,[c,d],e)=>{if(d.deniedValue&&(c.success=!1,c.remaining=0,c.reason="denyList",c.deniedValue=d.deniedValue),d.invalidIpDenyList){let d=y(a,b,e);c.pending=Promise.all([c.pending,d])}return c})(this.primaryRedis,this.prefix,f,this.denyListThreshold)};applyTimeout=a=>{let b=null,c=[a];if(this.timeout>0){let a=new Promise(a=>{b=setTimeout(()=>{a({success:!0,limit:0,remaining:0,reset:0,pending:Promise.resolve(),reason:"timeout"})},this.timeout)});c.push(a)}return{responseArray:c,newTimeoutId:b}};submitAnalytics=(a,b,c)=>{if(this.analytics)try{let d=c?this.analytics.extractGeo(c):void 0,e=this.analytics.record({identifier:"denyList"===a.reason?a.deniedValue:b,time:Date.now(),success:"denyList"===a.reason?"denied":a.success,...d}).catch(a=>{let b="Failed to record analytics";`${a}`.includes("WRONGTYPE")&&(b=`
    Failed to record analytics. See the information below:

    This can occur when you uprade to Ratelimit version 1.1.2
    or later from an earlier version.

    This occurs simply because the way we store analytics data
    has changed. To avoid getting this error, disable analytics
    for *an hour*, then simply enable it back.

    `),console.warn(b,a)});a.pending=Promise.all([a.pending,e])}catch(a){console.warn("Failed to record analytics",a)}return a};getKey=a=>[this.prefix,a].join(":");getDefinedMembers=(a,b)=>[a,b?.ip,b?.userAgent,b?.country].filter(Boolean)};function D(){let a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=b.length;for(let d=0;d<16;d++)a+=b.charAt(Math.floor(Math.random()*c));return a}var E=class extends C{constructor(a){super({prefix:a.prefix,limiter:a.limiter,timeout:a.timeout,analytics:a.analytics,ctx:{regionContexts:a.redis.map(a=>({redis:a})),cache:a.ephemeralCache?new l(a.ephemeralCache):void 0}})}static fixedWindow(a,b){let c=m(b);return()=>({async limit(b,d,e){let f=D(),g=Math.floor(Date.now()/c),h=[d,g].join(":"),i=e??1;if(b.cache&&i>0){let{blocked:c,reset:e}=b.cache.isBlocked(d);if(c)return{success:!1,limit:a,remaining:0,reset:e,pending:Promise.resolve(),reason:"cacheBlock"}}let j=b.regionContexts.map(a=>({redis:a.redis,request:n(a,p.fixedWindow.limit,[h],[f,c,i])})),k=a-(await Promise.any(j.map(a=>a.request))).reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0);async function l(){let b=[...new Set((await Promise.all(j.map(a=>a.request))).flat().reduce((a,b,c)=>(c%2==0&&a.push(b),a),[])).values()];for(let c of j){let d=(await c.request).reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0),e=(await c.request).reduce((a,b,c)=>(c%2==0&&a.push(b),a),[]);if(d>=a)continue;let f=b.filter(a=>!e.includes(a));if(0!==f.length)for(let a of f)await c.redis.hset(h,{[a]:i})}}let m=k>=0,o=(g+1)*c;return b.cache&&(m?i<0&&b.cache.pop(d):b.cache.blockUntil(d,o)),{success:m,limit:a,remaining:k,reset:o,pending:l()}},async getRemaining(b,d){let e=Math.floor(Date.now()/c),f=[d,e].join(":"),g=b.regionContexts.map(a=>({redis:a.redis,request:n(a,p.fixedWindow.getRemaining,[f],[null])}));return{remaining:Math.max(0,a-(await Promise.any(g.map(a=>a.request))).reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0)),reset:(e+1)*c}},async resetTokens(a,b){let c=[b,"*"].join(":");a.cache&&a.cache.pop(b),await Promise.all(a.regionContexts.map(a=>{n(a,q,[c],[null])}))}})}static slidingWindow(a,b){let c=m(b),d=m(b);return()=>({async limit(b,e,f){let g=D(),h=Date.now(),i=Math.floor(h/c),j=[e,i].join(":"),k=[e,i-1].join(":"),l=f??1;if(b.cache&&l>0){let{blocked:c,reset:d}=b.cache.isBlocked(e);if(c)return{success:!1,limit:a,remaining:0,reset:d,pending:Promise.resolve(),reason:"cacheBlock"}}let m=b.regionContexts.map(b=>({redis:b.redis,request:n(b,p.slidingWindow.limit,[j,k],[a,h,d,g,l])})),o=h%d/d,[q,r,s]=await Promise.any(m.map(a=>a.request));s&&q.push(g,l.toString());let t=a-(Math.ceil(r.reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0)*(1-o))+q.reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0));async function u(){let b=[...new Set((await Promise.all(m.map(a=>a.request))).flatMap(([a])=>a).reduce((a,b,c)=>(c%2==0&&a.push(b),a),[])).values()];for(let c of m){let[d,e,f]=await c.request,g=d.reduce((a,b,c)=>(c%2==0&&a.push(b),a),[]);if(d.reduce((a,b,c)=>{let d=0;return c%2&&(d=Number.parseInt(b)),a+d},0)>=a)continue;let h=b.filter(a=>!g.includes(a));if(0!==h.length)for(let a of h)await c.redis.hset(j,{[a]:l})}}let v=(i+1)*d;return b.cache&&(s?l<0&&b.cache.pop(e):b.cache.blockUntil(e,v)),{success:!!s,limit:a,remaining:Math.max(0,t),reset:v,pending:u()}},async getRemaining(b,d){let e=Date.now(),f=Math.floor(e/c),g=[d,f].join(":"),h=[d,f-1].join(":"),i=b.regionContexts.map(a=>({redis:a.redis,request:n(a,p.slidingWindow.getRemaining,[g,h],[e,c])}));return{remaining:Math.max(0,a-await Promise.any(i.map(a=>a.request))),reset:(f+1)*c}},async resetTokens(a,b){let c=[b,"*"].join(":");a.cache&&a.cache.pop(b),await Promise.all(a.regionContexts.map(a=>{n(a,q,[c],[null])}))}})}},F=class extends C{constructor(a){super({prefix:a.prefix,limiter:a.limiter,timeout:a.timeout,analytics:a.analytics,ctx:{redis:a.redis},ephemeralCache:a.ephemeralCache,enableProtection:a.enableProtection,denyListThreshold:a.denyListThreshold})}static fixedWindow(a,b){let c=m(b);return()=>({async limit(b,d,e){let f=Math.floor(Date.now()/c),g=[d,f].join(":"),h=e??1;if(b.cache&&h>0){let{blocked:c,reset:e}=b.cache.isBlocked(d);if(c)return{success:!1,limit:a,remaining:0,reset:e,pending:Promise.resolve(),reason:"cacheBlock"}}let i=await n(b,o.fixedWindow.limit,[g],[c,h]),j=i<=a,k=Math.max(0,a-i),l=(f+1)*c;return b.cache&&(j?h<0&&b.cache.pop(d):b.cache.blockUntil(d,l)),{success:j,limit:a,remaining:k,reset:l,pending:Promise.resolve()}},async getRemaining(b,d){let e=Math.floor(Date.now()/c),f=[d,e].join(":");return{remaining:Math.max(0,a-await n(b,o.fixedWindow.getRemaining,[f],[null])),reset:(e+1)*c}},async resetTokens(a,b){let c=[b,"*"].join(":");a.cache&&a.cache.pop(b),await n(a,q,[c],[null])}})}static slidingWindow(a,b){let c=m(b);return()=>({async limit(b,d,e){let f=Date.now(),g=Math.floor(f/c),h=[d,g].join(":"),i=[d,g-1].join(":"),j=e??1;if(b.cache&&j>0){let{blocked:c,reset:e}=b.cache.isBlocked(d);if(c)return{success:!1,limit:a,remaining:0,reset:e,pending:Promise.resolve(),reason:"cacheBlock"}}let k=await n(b,o.slidingWindow.limit,[h,i],[a,f,c,j]),l=k>=0,m=(g+1)*c;return b.cache&&(l?j<0&&b.cache.pop(d):b.cache.blockUntil(d,m)),{success:l,limit:a,remaining:Math.max(0,k),reset:m,pending:Promise.resolve()}},async getRemaining(b,d){let e=Date.now(),f=Math.floor(e/c),g=[d,f].join(":"),h=[d,f-1].join(":");return{remaining:Math.max(0,a-await n(b,o.slidingWindow.getRemaining,[g,h],[e,c])),reset:(f+1)*c}},async resetTokens(a,b){let c=[b,"*"].join(":");a.cache&&a.cache.pop(b),await n(a,q,[c],[null])}})}static tokenBucket(a,b,c){let d=m(b);return()=>({async limit(b,e,f){let g=Date.now(),h=f??1;if(b.cache&&h>0){let{blocked:a,reset:d}=b.cache.isBlocked(e);if(a)return{success:!1,limit:c,remaining:0,reset:d,pending:Promise.resolve(),reason:"cacheBlock"}}let[i,j]=await n(b,o.tokenBucket.limit,[e],[c,d,a,g,h]),k=i>=0;return b.cache&&(k?h<0&&b.cache.pop(e):b.cache.blockUntil(e,j)),{success:k,limit:c,remaining:i,reset:j,pending:Promise.resolve()}},async getRemaining(a,b){let[e,f]=await n(a,o.tokenBucket.getRemaining,[b],[c]),g=Date.now()+d,h=f+d;return{remaining:e,reset:-1===f?g:h}},async resetTokens(a,b){a.cache&&a.cache.pop(b),await n(a,q,[b],[null])}})}static cachedFixedWindow(a,b){let c=m(b);return()=>({async limit(b,d,e){if(!b.cache)throw Error("This algorithm requires a cache");let f=Math.floor(Date.now()/c),g=[d,f].join(":"),h=(f+1)*c,i=e??1;if("number"==typeof b.cache.get(g)){let d=b.cache.incr(g,i),e=d<a,f=e?n(b,o.cachedFixedWindow.limit,[g],[c,i]):Promise.resolve();return{success:e,limit:a,remaining:a-d,reset:h,pending:f}}let j=await n(b,o.cachedFixedWindow.limit,[g],[c,i]);b.cache.set(g,j);let k=a-j;return{success:k>=0,limit:a,remaining:k,reset:h,pending:Promise.resolve()}},async getRemaining(b,d){if(!b.cache)throw Error("This algorithm requires a cache");let e=Math.floor(Date.now()/c),f=[d,e].join(":");return"number"==typeof b.cache.get(f)?{remaining:Math.max(0,a-(b.cache.get(f)??0)),reset:(e+1)*c}:{remaining:Math.max(0,a-await n(b,o.cachedFixedWindow.getRemaining,[f],[null])),reset:(e+1)*c}},async resetTokens(a,b){if(!a.cache)throw Error("This algorithm requires a cache");let d=[b,Math.floor(Date.now()/c)].join(":");a.cache.pop(d);let e=[b,"*"].join(":");await n(a,q,[e],[null])}})}}},10741,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},77728,a=>{"use strict";let b;var c,d,e,f,g,h,i,j=a.i(43321),k=a.i(66879),l=a.i(9223);a.i(7418);var m=a.i(58836);a.s([],46115),a.i(46115),(c=f||(f={})).assertEqual=a=>{},c.assertIs=function(a){},c.assertNever=function(a){throw Error()},c.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},c.getValidEnumValues=a=>{let b=c.objectKeys(a).filter(b=>"number"!=typeof a[a[b]]),d={};for(let c of b)d[c]=a[c];return c.objectValues(d)},c.objectValues=a=>c.objectKeys(a).map(function(b){return a[b]}),c.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},c.find=(a,b)=>{for(let c of a)if(b(c))return c},c.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,c.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},c.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b,(g||(g={})).mergeShapes=(a,b)=>({...a,...b});let n=f.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),o=a=>{switch(typeof a){case"undefined":return n.undefined;case"string":return n.string;case"number":return Number.isNaN(a)?n.nan:n.number;case"boolean":return n.boolean;case"function":return n.function;case"bigint":return n.bigint;case"symbol":return n.symbol;case"object":if(Array.isArray(a))return n.array;if(null===a)return n.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return n.promise;if("undefined"!=typeof Map&&a instanceof Map)return n.map;if("undefined"!=typeof Set&&a instanceof Set)return n.set;if("undefined"!=typeof Date&&a instanceof Date)return n.date;return n.object;default:return n.unknown}};a.s(["ZodParsedType",0,n,"getParsedType",0,o,"objectUtil",()=>g,"util",()=>f],36007);let p=f.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),q=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class r extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof r))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,f.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}r.create=a=>new r(a),a.s(["ZodError",()=>r,"ZodIssueCode",0,p,"quotelessJson",0,q],92884);let s=(a,b)=>{let c;switch(a.code){case p.invalid_type:c=a.received===n.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case p.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,f.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:c=`Unrecognized key(s) in object: ${f.joinValues(a.keys,", ")}`;break;case p.invalid_union:c="Invalid input";break;case p.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${f.joinValues(a.options)}`;break;case p.invalid_enum_value:c=`Invalid enum value. Expected ${f.joinValues(a.options)}, received '${a.received}'`;break;case p.invalid_arguments:c="Invalid function arguments";break;case p.invalid_return_type:c="Invalid function return type";break;case p.invalid_date:c="Invalid date";break;case p.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:f.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case p.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case p.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case p.custom:c="Invalid input";break;case p.invalid_intersection_types:c="Intersection results could not be merged";break;case p.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case p.not_finite:c="Number must be finite";break;default:c=b.defaultError,f.assertNever(a)}return{message:c}},t=s;function u(a){t=a}function v(){return t}a.s(["getErrorMap",()=>v,"setErrorMap",()=>u],72826),a.i(72826),a.s(["defaultErrorMap",0,s,"getErrorMap",()=>v,"setErrorMap",()=>u],46506),a.i(46506);let w=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},x=[];function y(a,b){let c=t,d=w({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===s?void 0:s].filter(a=>!!a)});a.common.issues.push(d)}class z{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return A;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return z.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return A;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let A=Object.freeze({status:"aborted"}),B=a=>({status:"dirty",value:a}),C=a=>({status:"valid",value:a}),D=a=>"aborted"===a.status,E=a=>"dirty"===a.status,F=a=>"valid"===a.status,G=a=>"undefined"!=typeof Promise&&a instanceof Promise;a.s(["DIRTY",0,B,"EMPTY_PATH",0,x,"INVALID",0,A,"OK",0,C,"ParseStatus",()=>z,"addIssueToContext",()=>y,"isAborted",0,D,"isAsync",0,G,"isDirty",0,E,"isValid",0,F,"makeIssue",0,w],69997),a.i(69997),a.s([],94273),a.i(94273),a.i(36007),(d=h||(h={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},d.toString=a=>"string"==typeof a?a:a?.message;class H{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let I=(a,b)=>{if(F(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new r(a.common.issues);return this._error=b,this._error}}};function J(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class K{get description(){return this._def.description}_getType(a){return o(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:o(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new z,ctx:{common:a.parent.common,data:a.data,parsedType:o(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(G(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:o(a)},d=this._parseSync({data:a,path:c.path,parent:c});return I(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:o(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return F(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>F(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:o(a)},d=this._parse({data:a,path:c.path,parent:c});return I(c,await (G(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:p.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new aE({schema:this,typeName:i.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return aF.create(this,this._def)}nullable(){return aG.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return an.create(this)}promise(){return aD.create(this,this._def)}or(a){return ap.create([this,a],this._def)}and(a){return as.create(this,a,this._def)}transform(a){return new aE({...J(this._def),schema:this,typeName:i.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new aH({...J(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:i.ZodDefault})}brand(){return new aL({typeName:i.ZodBranded,type:this,...J(this._def)})}catch(a){return new aI({...J(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:i.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return aM.create(this,a)}readonly(){return aN.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let L=/^c[^\s-]{8,}$/i,M=/^[0-9a-z]+$/,N=/^[0-9A-HJKMNP-TV-Z]{26}$/i,O=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,P=/^[a-z0-9_-]{21}$/i,Q=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,R=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,S=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,T=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,U=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,V=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,W=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,X=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Y=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Z="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$=RegExp(`^${Z}$`);function _(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function aa(a){let b=`${Z}T${_(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class ab extends K{_parse(a){var c,d,e,g;let h;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==n.string){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.string,received:b.parsedType}),A}let i=new z;for(let j of this._def.checks)if("min"===j.kind)a.data.length<j.value&&(y(h=this._getOrReturnCtx(a,h),{code:p.too_small,minimum:j.value,type:"string",inclusive:!0,exact:!1,message:j.message}),i.dirty());else if("max"===j.kind)a.data.length>j.value&&(y(h=this._getOrReturnCtx(a,h),{code:p.too_big,maximum:j.value,type:"string",inclusive:!0,exact:!1,message:j.message}),i.dirty());else if("length"===j.kind){let b=a.data.length>j.value,c=a.data.length<j.value;(b||c)&&(h=this._getOrReturnCtx(a,h),b?y(h,{code:p.too_big,maximum:j.value,type:"string",inclusive:!0,exact:!0,message:j.message}):c&&y(h,{code:p.too_small,minimum:j.value,type:"string",inclusive:!0,exact:!0,message:j.message}),i.dirty())}else if("email"===j.kind)S.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"email",code:p.invalid_string,message:j.message}),i.dirty());else if("emoji"===j.kind)b||(b=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),b.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"emoji",code:p.invalid_string,message:j.message}),i.dirty());else if("uuid"===j.kind)O.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"uuid",code:p.invalid_string,message:j.message}),i.dirty());else if("nanoid"===j.kind)P.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"nanoid",code:p.invalid_string,message:j.message}),i.dirty());else if("cuid"===j.kind)L.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"cuid",code:p.invalid_string,message:j.message}),i.dirty());else if("cuid2"===j.kind)M.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"cuid2",code:p.invalid_string,message:j.message}),i.dirty());else if("ulid"===j.kind)N.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"ulid",code:p.invalid_string,message:j.message}),i.dirty());else if("url"===j.kind)try{new URL(a.data)}catch{y(h=this._getOrReturnCtx(a,h),{validation:"url",code:p.invalid_string,message:j.message}),i.dirty()}else"regex"===j.kind?(j.regex.lastIndex=0,j.regex.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"regex",code:p.invalid_string,message:j.message}),i.dirty())):"trim"===j.kind?a.data=a.data.trim():"includes"===j.kind?a.data.includes(j.value,j.position)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:{includes:j.value,position:j.position},message:j.message}),i.dirty()):"toLowerCase"===j.kind?a.data=a.data.toLowerCase():"toUpperCase"===j.kind?a.data=a.data.toUpperCase():"startsWith"===j.kind?a.data.startsWith(j.value)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:{startsWith:j.value},message:j.message}),i.dirty()):"endsWith"===j.kind?a.data.endsWith(j.value)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:{endsWith:j.value},message:j.message}),i.dirty()):"datetime"===j.kind?aa(j).test(a.data)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:"datetime",message:j.message}),i.dirty()):"date"===j.kind?$.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:"date",message:j.message}),i.dirty()):"time"===j.kind?RegExp(`^${_(j)}$`).test(a.data)||(y(h=this._getOrReturnCtx(a,h),{code:p.invalid_string,validation:"time",message:j.message}),i.dirty()):"duration"===j.kind?R.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"duration",code:p.invalid_string,message:j.message}),i.dirty()):"ip"===j.kind?(c=a.data,!(("v4"===(d=j.version)||!d)&&T.test(c)||("v6"===d||!d)&&V.test(c))&&1&&(y(h=this._getOrReturnCtx(a,h),{validation:"ip",code:p.invalid_string,message:j.message}),i.dirty())):"jwt"===j.kind?!function(a,b){if(!Q.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,j.alg)&&(y(h=this._getOrReturnCtx(a,h),{validation:"jwt",code:p.invalid_string,message:j.message}),i.dirty()):"cidr"===j.kind?(e=a.data,!(("v4"===(g=j.version)||!g)&&U.test(e)||("v6"===g||!g)&&W.test(e))&&1&&(y(h=this._getOrReturnCtx(a,h),{validation:"cidr",code:p.invalid_string,message:j.message}),i.dirty())):"base64"===j.kind?X.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"base64",code:p.invalid_string,message:j.message}),i.dirty()):"base64url"===j.kind?Y.test(a.data)||(y(h=this._getOrReturnCtx(a,h),{validation:"base64url",code:p.invalid_string,message:j.message}),i.dirty()):f.assertNever(j);return{status:i.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:p.invalid_string,...h.errToObj(c)})}_addCheck(a){return new ab({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...h.errToObj(a)})}url(a){return this._addCheck({kind:"url",...h.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...h.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...h.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...h.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...h.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...h.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...h.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...h.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...h.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...h.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...h.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...h.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...h.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...h.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...h.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...h.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...h.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...h.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...h.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...h.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...h.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...h.errToObj(b)})}nonempty(a){return this.min(1,h.errToObj(a))}trim(){return new ab({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ab({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ab({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}ab.create=a=>new ab({checks:[],typeName:i.ZodString,coerce:a?.coerce??!1,...J(a)});class ac extends K{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==n.number){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.number,received:b.parsedType}),A}let c=new z;for(let d of this._def.checks)"int"===d.kind?f.isInteger(a.data)||(y(b=this._getOrReturnCtx(a,b),{code:p.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,d.value)&&(y(b=this._getOrReturnCtx(a,b),{code:p.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(y(b=this._getOrReturnCtx(a,b),{code:p.not_finite,message:d.message}),c.dirty()):f.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,h.toString(b))}gt(a,b){return this.setLimit("min",a,!1,h.toString(b))}lte(a,b){return this.setLimit("max",a,!0,h.toString(b))}lt(a,b){return this.setLimit("max",a,!1,h.toString(b))}setLimit(a,b,c,d){return new ac({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:h.toString(d)}]})}_addCheck(a){return new ac({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:h.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:h.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:h.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:h.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:h.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:h.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:h.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:h.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:h.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&f.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}ac.create=a=>new ac({checks:[],typeName:i.ZodNumber,coerce:a?.coerce||!1,...J(a)});class ad extends K{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==n.bigint)return this._getInvalidInput(a);let c=new z;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(y(b=this._getOrReturnCtx(a,b),{code:p.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):f.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.bigint,received:b.parsedType}),A}gte(a,b){return this.setLimit("min",a,!0,h.toString(b))}gt(a,b){return this.setLimit("min",a,!1,h.toString(b))}lte(a,b){return this.setLimit("max",a,!0,h.toString(b))}lt(a,b){return this.setLimit("max",a,!1,h.toString(b))}setLimit(a,b,c,d){return new ad({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:h.toString(d)}]})}_addCheck(a){return new ad({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:h.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:h.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:h.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:h.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:h.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}ad.create=a=>new ad({checks:[],typeName:i.ZodBigInt,coerce:a?.coerce??!1,...J(a)});class ae extends K{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==n.boolean){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.boolean,received:b.parsedType}),A}return C(a.data)}}ae.create=a=>new ae({typeName:i.ZodBoolean,coerce:a?.coerce||!1,...J(a)});class af extends K{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==n.date){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.date,received:b.parsedType}),A}if(Number.isNaN(a.data.getTime()))return y(this._getOrReturnCtx(a),{code:p.invalid_date}),A;let c=new z;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(y(b=this._getOrReturnCtx(a,b),{code:p.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):f.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new af({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:h.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:h.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}af.create=a=>new af({checks:[],coerce:a?.coerce||!1,typeName:i.ZodDate,...J(a)});class ag extends K{_parse(a){if(this._getType(a)!==n.symbol){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.symbol,received:b.parsedType}),A}return C(a.data)}}ag.create=a=>new ag({typeName:i.ZodSymbol,...J(a)});class ah extends K{_parse(a){if(this._getType(a)!==n.undefined){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.undefined,received:b.parsedType}),A}return C(a.data)}}ah.create=a=>new ah({typeName:i.ZodUndefined,...J(a)});class ai extends K{_parse(a){if(this._getType(a)!==n.null){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.null,received:b.parsedType}),A}return C(a.data)}}ai.create=a=>new ai({typeName:i.ZodNull,...J(a)});class aj extends K{constructor(){super(...arguments),this._any=!0}_parse(a){return C(a.data)}}aj.create=a=>new aj({typeName:i.ZodAny,...J(a)});class ak extends K{constructor(){super(...arguments),this._unknown=!0}_parse(a){return C(a.data)}}ak.create=a=>new ak({typeName:i.ZodUnknown,...J(a)});class al extends K{_parse(a){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.never,received:b.parsedType}),A}}al.create=a=>new al({typeName:i.ZodNever,...J(a)});class am extends K{_parse(a){if(this._getType(a)!==n.undefined){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.void,received:b.parsedType}),A}return C(a.data)}}am.create=a=>new am({typeName:i.ZodVoid,...J(a)});class an extends K{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==n.array)return y(b,{code:p.invalid_type,expected:n.array,received:b.parsedType}),A;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(y(b,{code:a?p.too_big:p.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(y(b,{code:p.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(y(b,{code:p.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new H(b,a,b.path,c)))).then(a=>z.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new H(b,a,b.path,c)));return z.mergeArray(c,e)}get element(){return this._def.type}min(a,b){return new an({...this._def,minLength:{value:a,message:h.toString(b)}})}max(a,b){return new an({...this._def,maxLength:{value:a,message:h.toString(b)}})}length(a,b){return new an({...this._def,exactLength:{value:a,message:h.toString(b)}})}nonempty(a){return this.min(1,a)}}an.create=(a,b)=>new an({type:a,minLength:null,maxLength:null,exactLength:null,typeName:i.ZodArray,...J(b)});class ao extends K{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=f.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==n.object){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.object,received:b.parsedType}),A}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof al&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new H(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof al){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(y(c,{code:p.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new H(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>z.mergeObjectSync(b,a)):z.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(a){return h.errToObj,new ao({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:h.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new ao({...this._def,unknownKeys:"strip"})}passthrough(){return new ao({...this._def,unknownKeys:"passthrough"})}extend(a){return new ao({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new ao({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:i.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new ao({...this._def,catchall:a})}pick(a){let b={};for(let c of f.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new ao({...this._def,shape:()=>b})}omit(a){let b={};for(let c of f.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new ao({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof ao){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=aF.create(a(e))}return new ao({...b._def,shape:()=>c})}if(b instanceof an)return new an({...b._def,type:a(b.element)});if(b instanceof aF)return aF.create(a(b.unwrap()));if(b instanceof aG)return aG.create(a(b.unwrap()));if(b instanceof at)return at.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of f.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new ao({...this._def,shape:()=>b})}required(a){let b={};for(let c of f.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof aF;)a=a._def.innerType;b[c]=a}return new ao({...this._def,shape:()=>b})}keyof(){return aA(f.objectKeys(this.shape))}}ao.create=(a,b)=>new ao({shape:()=>a,unknownKeys:"strip",catchall:al.create(),typeName:i.ZodObject,...J(b)}),ao.strictCreate=(a,b)=>new ao({shape:()=>a,unknownKeys:"strict",catchall:al.create(),typeName:i.ZodObject,...J(b)}),ao.lazycreate=(a,b)=>new ao({shape:a,unknownKeys:"strip",catchall:al.create(),typeName:i.ZodObject,...J(b)});class ap extends K{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new r(a.ctx.common.issues));return y(b,{code:p.invalid_union,unionErrors:c}),A});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new r(a));return y(b,{code:p.invalid_union,unionErrors:e}),A}}get options(){return this._def.options}}ap.create=(a,b)=>new ap({options:a,typeName:i.ZodUnion,...J(b)});let aq=a=>{if(a instanceof ay)return aq(a.schema);if(a instanceof aE)return aq(a.innerType());if(a instanceof az)return[a.value];if(a instanceof aB)return a.options;if(a instanceof aC)return f.objectValues(a.enum);else if(a instanceof aH)return aq(a._def.innerType);else if(a instanceof ah)return[void 0];else if(a instanceof ai)return[null];else if(a instanceof aF)return[void 0,...aq(a.unwrap())];else if(a instanceof aG)return[null,...aq(a.unwrap())];else if(a instanceof aL)return aq(a.unwrap());else if(a instanceof aN)return aq(a.unwrap());else if(a instanceof aI)return aq(a._def.innerType);else return[]};class ar extends K{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==n.object)return y(b,{code:p.invalid_type,expected:n.object,received:b.parsedType}),A;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(y(b,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=aq(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new ar({typeName:i.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...J(c)})}}class as extends K{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=(a,d)=>{if(D(a)||D(d))return A;let e=function a(b,c){let d=o(b),e=o(c);if(b===c)return{valid:!0,data:b};if(d===n.object&&e===n.object){let d=f.objectKeys(c),e=f.objectKeys(b).filter(a=>-1!==d.indexOf(a)),g={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};g[d]=e.data}return{valid:!0,data:g}}if(d===n.array&&e===n.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(d===n.date&&e===n.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,d.value);return e.valid?((E(a)||E(d))&&b.dirty(),{status:b.value,value:e.data}):(y(c,{code:p.invalid_intersection_types}),A)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>d(a,b)):d(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}as.create=(a,b,c)=>new as({left:a,right:b,typeName:i.ZodIntersection,...J(c)});class at extends K{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==n.array)return y(c,{code:p.invalid_type,expected:n.array,received:c.parsedType}),A;if(c.data.length<this._def.items.length)return y(c,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&c.data.length>this._def.items.length&&(y(c,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new H(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>z.mergeArray(b,a)):z.mergeArray(b,d)}get items(){return this._def.items}rest(a){return new at({...this._def,rest:a})}}at.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new at({items:a,typeName:i.ZodTuple,rest:null,...J(b)})};class au extends K{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==n.object)return y(c,{code:p.invalid_type,expected:n.object,received:c.parsedType}),A;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new H(c,a,c.path,a)),value:f._parse(new H(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?z.mergeObjectAsync(b,d):z.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(a,b,c){return new au(b instanceof K?{keyType:a,valueType:b,typeName:i.ZodRecord,...J(c)}:{keyType:ab.create(),valueType:a,typeName:i.ZodRecord,...J(b)})}}class av extends K{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==n.map)return y(c,{code:p.invalid_type,expected:n.map,received:c.parsedType}),A;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new H(c,a,c.path,[f,"key"])),value:e._parse(new H(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return A;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return A;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}av.create=(a,b,c)=>new av({valueType:b,keyType:a,typeName:i.ZodMap,...J(c)});class aw extends K{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==n.set)return y(c,{code:p.invalid_type,expected:n.set,received:c.parsedType}),A;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(y(c,{code:p.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(y(c,{code:p.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return A;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new H(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(a,b){return new aw({...this._def,minSize:{value:a,message:h.toString(b)}})}max(a,b){return new aw({...this._def,maxSize:{value:a,message:h.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}aw.create=(a,b)=>new aw({valueType:a,minSize:null,maxSize:null,typeName:i.ZodSet,...J(b)});class ax extends K{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==n.function)return y(b,{code:p.invalid_type,expected:n.function,received:b.parsedType}),A;function c(a,c){return w({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,t,s].filter(a=>!!a),issueData:{code:p.invalid_arguments,argumentsError:c}})}function d(a,c){return w({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,t,s].filter(a=>!!a),issueData:{code:p.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof aD){let a=this;return C(async function(...b){let g=new r([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return C(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new r([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new r([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new ax({...this._def,args:at.create(a).rest(ak.create())})}returns(a){return new ax({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new ax({args:a||at.create([]).rest(ak.create()),returns:b||ak.create(),typeName:i.ZodFunction,...J(c)})}}class ay extends K{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}ay.create=(a,b)=>new ay({getter:a,typeName:i.ZodLazy,...J(b)});class az extends K{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return y(b,{received:b.data,code:p.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:a.data}}get value(){return this._def.value}}function aA(a,b){return new aB({values:a,typeName:i.ZodEnum,...J(b)})}az.create=(a,b)=>new az({value:a,typeName:i.ZodLiteral,...J(b)});class aB extends K{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return y(b,{expected:f.joinValues(c),received:b.parsedType,code:p.invalid_type}),A}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return y(b,{received:b.data,code:p.invalid_enum_value,options:c}),A}return C(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return aB.create(a,{...this._def,...b})}exclude(a,b=this._def){return aB.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}aB.create=aA;class aC extends K{_parse(a){let b=f.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==n.string&&c.parsedType!==n.number){let a=f.objectValues(b);return y(c,{expected:f.joinValues(a),received:c.parsedType,code:p.invalid_type}),A}if(this._cache||(this._cache=new Set(f.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=f.objectValues(b);return y(c,{received:c.data,code:p.invalid_enum_value,options:a}),A}return C(a.data)}get enum(){return this._def.values}}aC.create=(a,b)=>new aC({values:a,typeName:i.ZodNativeEnum,...J(b)});class aD extends K{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==n.promise&&!1===b.common.async?(y(b,{code:p.invalid_type,expected:n.promise,received:b.parsedType}),A):C((b.parsedType===n.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}aD.create=(a,b)=>new aD({type:a,typeName:i.ZodPromise,...J(b)});class aE extends K{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===i.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{y(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return A;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?A:"dirty"===d.status||"dirty"===b.value?B(d.value):d});{if("aborted"===b.value)return A;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?A:"dirty"===d.status||"dirty"===b.value?B(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?A:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?A:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>F(a)?Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})):A);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!F(a))return A;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}f.assertNever(d)}}aE.create=(a,b,c)=>new aE({schema:a,typeName:i.ZodEffects,effect:b,...J(c)}),aE.createWithPreprocess=(a,b,c)=>new aE({schema:b,effect:{type:"preprocess",transform:a},typeName:i.ZodEffects,...J(c)});class aF extends K{_parse(a){return this._getType(a)===n.undefined?C(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}aF.create=(a,b)=>new aF({innerType:a,typeName:i.ZodOptional,...J(b)});class aG extends K{_parse(a){return this._getType(a)===n.null?C(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}aG.create=(a,b)=>new aG({innerType:a,typeName:i.ZodNullable,...J(b)});class aH extends K{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===n.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}aH.create=(a,b)=>new aH({innerType:a,typeName:i.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...J(b)});class aI extends K{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return G(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new r(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new r(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}aI.create=(a,b)=>new aI({innerType:a,typeName:i.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...J(b)});class aJ extends K{_parse(a){if(this._getType(a)!==n.nan){let b=this._getOrReturnCtx(a);return y(b,{code:p.invalid_type,expected:n.nan,received:b.parsedType}),A}return{status:"valid",value:a.data}}}aJ.create=a=>new aJ({typeName:i.ZodNaN,...J(a)});let aK=Symbol("zod_brand");class aL extends K{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class aM extends K{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?A:"dirty"===a.status?(b.dirty(),B(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?A:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new aM({in:a,out:b,typeName:i.ZodPipeline})}}class aN extends K{_parse(a){let b=this._def.innerType._parse(a),c=a=>(F(a)&&(a.value=Object.freeze(a.value)),a);return G(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function aO(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function aP(a,b={},c){return a?aj.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=aO(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=aO(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):aj.create()}aN.create=(a,b)=>new aN({innerType:a,typeName:i.ZodReadonly,...J(b)});let aQ={object:ao.lazycreate};(e=i||(i={})).ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly";let aR=(a,b={message:`Input not instance of ${a.name}`})=>aP(b=>b instanceof a,b),aS=ab.create,aT=ac.create,aU=aJ.create,aV=ad.create,aW=ae.create,aX=af.create,aY=ag.create,aZ=ah.create,a$=ai.create,a_=aj.create,a0=ak.create,a1=al.create,a2=am.create,a3=an.create,a4=ao.create,a5=ao.strictCreate,a6=ap.create,a7=ar.create,a8=as.create,a9=at.create,ba=au.create,bb=av.create,bc=aw.create,bd=ax.create,be=ay.create,bf=az.create,bg=aB.create,bh=aC.create,bi=aD.create,bj=aE.create,bk=aF.create,bl=aG.create,bm=aE.createWithPreprocess,bn=aM.create,bo=()=>aS().optional(),bp=()=>aT().optional(),bq=()=>aW().optional(),br={string:a=>ab.create({...a,coerce:!0}),number:a=>ac.create({...a,coerce:!0}),boolean:a=>ae.create({...a,coerce:!0}),bigint:a=>ad.create({...a,coerce:!0}),date:a=>af.create({...a,coerce:!0})};a.s(["BRAND",0,aK,"NEVER",0,A,"Schema",()=>K,"ZodAny",()=>aj,"ZodArray",()=>an,"ZodBigInt",()=>ad,"ZodBoolean",()=>ae,"ZodBranded",()=>aL,"ZodCatch",()=>aI,"ZodDate",()=>af,"ZodDefault",()=>aH,"ZodDiscriminatedUnion",()=>ar,"ZodEffects",()=>aE,"ZodEnum",()=>aB,"ZodFirstPartyTypeKind",()=>i,"ZodFunction",()=>ax,"ZodIntersection",()=>as,"ZodLazy",()=>ay,"ZodLiteral",()=>az,"ZodMap",()=>av,"ZodNaN",()=>aJ,"ZodNativeEnum",()=>aC,"ZodNever",()=>al,"ZodNull",()=>ai,"ZodNullable",()=>aG,"ZodNumber",()=>ac,"ZodObject",()=>ao,"ZodOptional",()=>aF,"ZodPipeline",()=>aM,"ZodPromise",()=>aD,"ZodReadonly",()=>aN,"ZodRecord",()=>au,"ZodSchema",()=>K,"ZodSet",()=>aw,"ZodString",()=>ab,"ZodSymbol",()=>ag,"ZodTransformer",()=>aE,"ZodTuple",()=>at,"ZodType",()=>K,"ZodUndefined",()=>ah,"ZodUnion",()=>ap,"ZodUnknown",()=>ak,"ZodVoid",()=>am,"any",()=>a_,"array",()=>a3,"bigint",()=>aV,"boolean",()=>aW,"coerce",0,br,"custom",()=>aP,"date",()=>aX,"datetimeRegex",()=>aa,"discriminatedUnion",()=>a7,"effect",()=>bj,"enum",()=>bg,"function",()=>bd,"instanceof",()=>aR,"intersection",()=>a8,"late",0,aQ,"lazy",()=>be,"literal",()=>bf,"map",()=>bb,"nan",()=>aU,"nativeEnum",()=>bh,"never",()=>a1,"null",()=>a$,"nullable",()=>bl,"number",()=>aT,"object",()=>a4,"oboolean",()=>bq,"onumber",()=>bp,"optional",()=>bk,"ostring",()=>bo,"pipeline",()=>bn,"preprocess",()=>bm,"promise",()=>bi,"record",()=>ba,"set",()=>bc,"strictObject",()=>a5,"string",()=>aS,"symbol",()=>aY,"transformer",()=>bj,"tuple",()=>a9,"undefined",()=>aZ,"union",()=>a6,"unknown",()=>a0,"void",()=>a2],79934),a.i(79934),a.i(92884),a.s(["BRAND",0,aK,"DIRTY",0,B,"EMPTY_PATH",0,x,"INVALID",0,A,"NEVER",0,A,"OK",0,C,"ParseStatus",()=>z,"Schema",()=>K,"ZodAny",()=>aj,"ZodArray",()=>an,"ZodBigInt",()=>ad,"ZodBoolean",()=>ae,"ZodBranded",()=>aL,"ZodCatch",()=>aI,"ZodDate",()=>af,"ZodDefault",()=>aH,"ZodDiscriminatedUnion",()=>ar,"ZodEffects",()=>aE,"ZodEnum",()=>aB,"ZodError",()=>r,"ZodFirstPartyTypeKind",()=>i,"ZodFunction",()=>ax,"ZodIntersection",()=>as,"ZodIssueCode",0,p,"ZodLazy",()=>ay,"ZodLiteral",()=>az,"ZodMap",()=>av,"ZodNaN",()=>aJ,"ZodNativeEnum",()=>aC,"ZodNever",()=>al,"ZodNull",()=>ai,"ZodNullable",()=>aG,"ZodNumber",()=>ac,"ZodObject",()=>ao,"ZodOptional",()=>aF,"ZodParsedType",0,n,"ZodPipeline",()=>aM,"ZodPromise",()=>aD,"ZodReadonly",()=>aN,"ZodRecord",()=>au,"ZodSchema",()=>K,"ZodSet",()=>aw,"ZodString",()=>ab,"ZodSymbol",()=>ag,"ZodTransformer",()=>aE,"ZodTuple",()=>at,"ZodType",()=>K,"ZodUndefined",()=>ah,"ZodUnion",()=>ap,"ZodUnknown",()=>ak,"ZodVoid",()=>am,"addIssueToContext",()=>y,"any",()=>a_,"array",()=>a3,"bigint",()=>aV,"boolean",()=>aW,"coerce",0,br,"custom",()=>aP,"date",()=>aX,"datetimeRegex",()=>aa,"defaultErrorMap",0,s,"discriminatedUnion",()=>a7,"effect",()=>bj,"enum",()=>bg,"function",()=>bd,"getErrorMap",()=>v,"getParsedType",0,o,"instanceof",()=>aR,"intersection",()=>a8,"isAborted",0,D,"isAsync",0,G,"isDirty",0,E,"isValid",0,F,"late",0,aQ,"lazy",()=>be,"literal",()=>bf,"makeIssue",0,w,"map",()=>bb,"nan",()=>aU,"nativeEnum",()=>bh,"never",()=>a1,"null",()=>a$,"nullable",()=>bl,"number",()=>aT,"object",()=>a4,"objectUtil",()=>g,"oboolean",()=>bq,"onumber",()=>bp,"optional",()=>bk,"ostring",()=>bo,"pipeline",()=>bn,"preprocess",()=>bm,"promise",()=>bi,"quotelessJson",0,q,"record",()=>ba,"set",()=>bc,"setErrorMap",()=>u,"strictObject",()=>a5,"string",()=>aS,"symbol",()=>aY,"transformer",()=>bj,"tuple",()=>a9,"undefined",()=>aZ,"union",()=>a6,"unknown",()=>a0,"util",()=>f,"void",()=>a2],10815);var bs=a.i(10815),bs=bs,bt=a.i(66680);let bu=bt.default.webcrypto?.subtle||{};var bv=Object.defineProperty,bw={},bx={UpstashError:()=>bz,UpstashJSONParseError:()=>bB,UrlError:()=>bA};for(var by in bx)bv(bw,by,{get:bx[by],enumerable:!0});var bz=class extends Error{constructor(a,b){super(a,b),this.name="UpstashError"}},bA=class extends Error{constructor(a){super(`Upstash Redis client was passed an invalid URL. You should pass a URL starting with https. Received: "${a}". `),this.name="UrlError"}},bB=class extends bz{constructor(a,b){super(`Unable to parse response body: ${a.length>200?a.slice(0,200)+"...":a}`,b),this.name="UpstashJSONParseError"}};function bC(a){try{return function a(b){let c=Array.isArray(b)?b.map(b=>{try{return a(b)}catch{return b}}):JSON.parse(b);return"number"==typeof c&&c.toString()!==b?b:c}(a)}catch{return a}}function bD(a){return[a[0],...bC(a.slice(1))]}function bE(a){let[b,c]=a,d=[];for(let a=0;a<c.length;a+=2)d.push({key:c[a],type:c[a+1]});return[b,d]}function bF(a){if("object"==typeof a&&null!==a&&!Array.isArray(a))return a;if(!Array.isArray(a))return{};let b={};for(let c=0;c<a.length;c+=2)"string"==typeof a[c]&&(b[a[c]]=a[c+1]);return b}var bG=class{baseUrl;headers;options;readYourWrites;upstashSyncToken="";hasCredentials;retry;constructor(a){if(this.options={backend:a.options?.backend,agent:a.agent,responseEncoding:a.responseEncoding??"base64",cache:a.cache,signal:a.signal,keepAlive:a.keepAlive??!0},this.upstashSyncToken="",this.readYourWrites=a.readYourWrites??!0,this.baseUrl=(a.baseUrl||"").replace(/\/$/,""),this.baseUrl&&!/^https?:\/\/[^\s#$./?].\S*$/.test(this.baseUrl))throw new bA(this.baseUrl);this.headers={"Content-Type":"application/json",...a.headers},this.hasCredentials=!!(this.baseUrl&&this.headers.authorization.split(" ")[1]),"base64"===this.options.responseEncoding&&(this.headers["Upstash-Encoding"]="base64"),this.retry="boolean"!=typeof a.retry||a.retry?{attempts:a.retry?.retries??5,backoff:a.retry?.backoff??(a=>50*Math.exp(a))}:{attempts:1,backoff:()=>0}}mergeTelemetry(a){this.headers=bJ(this.headers,"Upstash-Telemetry-Runtime",a.runtime),this.headers=bJ(this.headers,"Upstash-Telemetry-Platform",a.platform),this.headers=bJ(this.headers,"Upstash-Telemetry-Sdk",a.sdk)}async request(a){let b,c=function(...a){let b={};for(let c of a)if(c)for(let[a,d]of Object.entries(c))null!=d&&(b[a]=d);return b}(this.headers,a.headers??{}),d=[this.baseUrl,...a.path??[]].join("/"),e="text/event-stream"===c.Accept,f=a.signal??this.options.signal,g="function"==typeof f,h={cache:this.options.cache,method:"POST",headers:c,body:JSON.stringify(a.body),keepalive:this.options.keepAlive,agent:this.options.agent,signal:g?f():f,backend:this.options.backend};if(this.hasCredentials||console.warn("[Upstash Redis] Redis client was initialized without url or token. Failed to execute command."),this.readYourWrites){let a=this.upstashSyncToken;this.headers["upstash-sync-token"]=a}let i=null,j=null;for(let a=0;a<=this.retry.attempts;a++)try{i=await fetch(d,h);break}catch(b){if(h.signal?.aborted&&g)throw b;if(h.signal?.aborted){i=new Response(new Blob([JSON.stringify({result:h.signal.reason??"Aborted"})]),{status:200,statusText:h.signal.reason??"Aborted"});break}j=b,a<this.retry.attempts&&await new Promise(b=>setTimeout(b,this.retry.backoff(a)))}if(!i)throw j??Error("Exhausted all retries");if(!i.ok){let b,c=await i.text();try{b=JSON.parse(c)}catch(a){throw new bB(c,{cause:a})}throw new bz(`${b.error}, command was: ${JSON.stringify(a.body)}`)}if(this.readYourWrites){let a=i.headers;this.upstashSyncToken=a.get("upstash-sync-token")??""}if(e&&a&&a.onMessage&&i.body){let b=i.body.getReader(),c=new TextDecoder;return(async()=>{try{for(;;){let{value:d,done:e}=await b.read();if(e)break;for(let b of c.decode(d).split("\n"))if(b.startsWith("data: ")){let c=b.slice(6);a.onMessage?.(c)}}}catch(a){a instanceof Error&&"AbortError"===a.name||console.error("Stream reading error:",a)}finally{try{await b.cancel()}catch{}}})(),{result:1}}let k=await i.text();try{b=JSON.parse(k)}catch(a){throw new bB(k,{cause:a})}if(this.readYourWrites){let a=i.headers;this.upstashSyncToken=a.get("upstash-sync-token")??""}return"base64"===this.options.responseEncoding?Array.isArray(b)?b.map(({result:a,error:b})=>({result:bI(a),error:b})):{result:bI(b.result),error:b.error}:b}};function bH(a){let b="";try{let c=atob(a),d=c.length,e=new Uint8Array(d);for(let a=0;a<d;a++)e[a]=c.charCodeAt(a);b=new TextDecoder().decode(e)}catch{b=a}return b}function bI(a){let b;switch(typeof a){case"undefined":return a;case"number":b=a;break;case"object":b=Array.isArray(a)?a.map(a=>"string"==typeof a?bH(a):Array.isArray(a)?a.map(a=>bI(a)):a):null;break;case"string":b="OK"===a?"OK":bH(a)}return b}function bJ(a,b,c){return c&&(a[b]=a[b]?[a[b],c].join(","):c),a}var bK=a=>{switch(typeof a){case"string":case"number":case"boolean":return a;default:return JSON.stringify(a)}},bL=class{command;serialize;deserialize;headers;path;onMessage;isStreaming;signal;constructor(a,b){if(this.serialize=bK,this.deserialize=b?.automaticDeserialization===void 0||b.automaticDeserialization?b?.deserialize??bC:a=>a,this.command=a.map(a=>this.serialize(a)),this.headers=b?.headers,this.path=b?.path,this.onMessage=b?.streamOptions?.onMessage,this.isStreaming=b?.streamOptions?.isStreaming??!1,this.signal=b?.streamOptions?.signal,b?.latencyLogging){const a=this.exec.bind(this);this.exec=async b=>{let c=performance.now(),d=await a(b),e=(performance.now()-c).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.command[0].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${e} ms\x1b[0m`),d}}}async exec(a){let{result:b,error:c}=await a.request({body:this.command,path:this.path,upstashSyncToken:a.upstashSyncToken,headers:this.headers,onMessage:this.onMessage,isStreaming:this.isStreaming,signal:this.signal});if(c)throw new bz(c);if(void 0===b)throw TypeError("Request did not return a result");return this.deserialize(b)}},bM=class extends bL{constructor(a,b){const c=["hrandfield",a[0]];"number"==typeof a[1]&&c.push(a[1]),a[2]&&c.push("WITHVALUES"),super(c,{deserialize:a[2]?a=>(function(a){if(0===a.length)return null;let b={};for(let c=0;c<a.length;c+=2){let d=a[c],e=a[c+1];try{b[d]=JSON.parse(e)}catch{b[d]=e}}return b})(a):b?.deserialize,...b})}},bN=class extends bL{constructor(a,b){super(["append",...a],b)}},bO=class extends bL{constructor([a,b,c],d){const e=["bitcount",a];"number"==typeof b&&e.push(b),"number"==typeof c&&e.push(c),super(e,d)}},bP=class{constructor(a,b,c,d=a=>a.exec(this.client)){this.client=b,this.opts=c,this.execOperation=d,this.command=["bitfield",...a]}command;chain(...a){return this.command.push(...a),this}get(...a){return this.chain("get",...a)}set(...a){return this.chain("set",...a)}incrby(...a){return this.chain("incrby",...a)}overflow(a){return this.chain("overflow",a)}exec(){let a=new bL(this.command,this.opts);return this.execOperation(a)}},bQ=class extends bL{constructor(a,b){super(["bitop",...a],b)}},bR=class extends bL{constructor(a,b){super(["bitpos",...a],b)}},bS=class extends bL{constructor([a,b,c],d){super(["COPY",a,b,...c?.replace?["REPLACE"]:[]],{...d,deserialize:a=>a>0?"COPIED":"NOT_COPIED"})}},bT=class extends bL{constructor(a){super(["dbsize"],a)}},bU=class extends bL{constructor(a,b){super(["decr",...a],b)}},bV=class extends bL{constructor(a,b){super(["decrby",...a],b)}},bW=class extends bL{constructor(a,b){super(["del",...a],b)}},bX=class extends bL{constructor(a,b){super(["echo",...a],b)}},bY=class extends bL{constructor([a,b,c],d){super(["eval_ro",a,b.length,...b,...c??[]],d)}},bZ=class extends bL{constructor([a,b,c],d){super(["eval",a,b.length,...b,...c??[]],d)}},b$=class extends bL{constructor([a,b,c],d){super(["evalsha_ro",a,b.length,...b,...c??[]],d)}},b_=class extends bL{constructor([a,b,c],d){super(["evalsha",a,b.length,...b,...c??[]],d)}},b0=class extends bL{constructor(a,b){super(a.map(a=>"string"==typeof a?a:String(a)),b)}},b1=class extends bL{constructor(a,b){super(["exists",...a],b)}},b2=class extends bL{constructor(a,b){super(["expire",...a.filter(Boolean)],b)}},b3=class extends bL{constructor(a,b){super(["expireat",...a],b)}},b4=class extends bL{constructor([a,b,c],d){super(["fcall",a,...b?[b.length,...b]:[0],...c??[]],d)}},b5=class extends bL{constructor([a,b,c],d){super(["fcall_ro",a,...b?[b.length,...b]:[0],...c??[]],d)}},b6=class extends bL{constructor(a,b){const c=["flushall"];a&&a.length>0&&a[0].async&&c.push("async"),super(c,b)}},b7=class extends bL{constructor([a],b){const c=["flushdb"];a?.async&&c.push("async"),super(c,b)}},b8=class extends bL{constructor([a],b){super(["function","delete",a],b)}},b9=class extends bL{constructor(a){super(["function","flush"],a)}},ca=class extends bL{constructor([a],b){const c=["function","list"];a?.libraryName&&c.push("libraryname",a.libraryName),a?.withCode&&c.push("withcode"),super(c,{deserialize:cb,...b})}};function cb(a){return Array.isArray(a)?a.map(a=>{let b=bF(a),c=b.functions.map(a=>bF(a));return{libraryName:b.library_name,engine:b.engine,functions:c.map(a=>({name:a.name,description:a.description??void 0,flags:a.flags})),libraryCode:b.library_code}}):[]}var cc=class extends bL{constructor([a],b){super(["function","load",...a.replace?["replace"]:[],a.code],b)}},cd=class extends bL{constructor(a){super(["function","stats"],{deserialize:ce,...a})}};function ce(a){return{engines:Object.fromEntries(Object.entries(Object.fromEntries(Object.entries(bF(bF(a).engines)).map(([a,b])=>[a,bF(b)]))).map(([a,b])=>[a,{librariesCount:b.libraries_count,functionsCount:b.functions_count}]))}}var cf=class extends bL{constructor([a,b,...c],d){const e=["geoadd",a];"nx"in b&&b.nx?e.push("nx"):"xx"in b&&b.xx&&e.push("xx"),"ch"in b&&b.ch&&e.push("ch"),"latitude"in b&&b.latitude&&e.push(b.longitude,b.latitude,b.member),e.push(...c.flatMap(({latitude:a,longitude:b,member:c})=>[b,a,c])),super(e,d)}},cg=class extends bL{constructor([a,b,c,d="M"],e){super(["GEODIST",a,b,c,d],e)}},ch=class extends bL{constructor(a,b){const[c]=a;super(["GEOHASH",c,...Array.isArray(a[1])?a[1]:a.slice(1)],b)}},ci=class extends bL{constructor(a,b){const[c]=a;super(["GEOPOS",c,...Array.isArray(a[1])?a[1]:a.slice(1)],{deserialize:a=>(function(a){let b=[];for(let c of a)c?.[0]&&c?.[1]&&b.push({lng:Number.parseFloat(c[0]),lat:Number.parseFloat(c[1])});return b})(a),...b})}},cj=class extends bL{constructor([a,b,c,d,e],f){const g=["GEOSEARCH",a];("FROMMEMBER"===b.type||"frommember"===b.type)&&g.push(b.type,b.member),("FROMLONLAT"===b.type||"fromlonlat"===b.type)&&g.push(b.type,b.coordinate.lon,b.coordinate.lat),("BYRADIUS"===c.type||"byradius"===c.type)&&g.push(c.type,c.radius,c.radiusType),("BYBOX"===c.type||"bybox"===c.type)&&g.push(c.type,c.rect.width,c.rect.height,c.rectType),g.push(d),e?.count&&g.push("COUNT",e.count.limit,...e.count.any?["ANY"]:[]),super([...g,...e?.withCoord?["WITHCOORD"]:[],...e?.withDist?["WITHDIST"]:[],...e?.withHash?["WITHHASH"]:[]],{deserialize:a=>e?.withCoord||e?.withDist||e?.withHash?a.map(a=>{let b=1,c={};try{c.member=JSON.parse(a[0])}catch{c.member=a[0]}return e.withDist&&(c.dist=Number.parseFloat(a[b++])),e.withHash&&(c.hash=a[b++].toString()),e.withCoord&&(c.coord={long:Number.parseFloat(a[b][0]),lat:Number.parseFloat(a[b][1])}),c}):a.map(a=>{try{return{member:JSON.parse(a)}}catch{return{member:a}}}),...f})}},ck=class extends bL{constructor([a,b,c,d,e,f],g){const h=["GEOSEARCHSTORE",a,b];("FROMMEMBER"===c.type||"frommember"===c.type)&&h.push(c.type,c.member),("FROMLONLAT"===c.type||"fromlonlat"===c.type)&&h.push(c.type,c.coordinate.lon,c.coordinate.lat),("BYRADIUS"===d.type||"byradius"===d.type)&&h.push(d.type,d.radius,d.radiusType),("BYBOX"===d.type||"bybox"===d.type)&&h.push(d.type,d.rect.width,d.rect.height,d.rectType),h.push(e),f?.count&&h.push("COUNT",f.count.limit,...f.count.any?["ANY"]:[]),super([...h,...f?.storeDist?["STOREDIST"]:[]],g)}},cl=class extends bL{constructor(a,b){super(["get",...a],b)}},cm=class extends bL{constructor(a,b){super(["getbit",...a],b)}},cn=class extends bL{constructor(a,b){super(["getdel",...a],b)}},co=class extends bL{constructor([a,b],c){const d=["getex",a];b&&("ex"in b&&"number"==typeof b.ex?d.push("ex",b.ex):"px"in b&&"number"==typeof b.px?d.push("px",b.px):"exat"in b&&"number"==typeof b.exat?d.push("exat",b.exat):"pxat"in b&&"number"==typeof b.pxat?d.push("pxat",b.pxat):"persist"in b&&b.persist&&d.push("persist")),super(d,c)}},cp=class extends bL{constructor(a,b){super(["getrange",...a],b)}},cq=class extends bL{constructor(a,b){super(["getset",...a],b)}},cr=class extends bL{constructor(a,b){super(["hdel",...a],b)}},cs=class extends bL{constructor(a,b){super(["hexists",...a],b)}},ct=class extends bL{constructor(a,b){const[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hexpire",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},cu=class extends bL{constructor(a,b){const[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hexpireat",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},cv=class extends bL{constructor(a,b){const[c,d]=a,e=Array.isArray(d)?d:[d];super(["hexpiretime",c,"FIELDS",e.length,...e],b)}},cw=class extends bL{constructor(a,b){const[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpersist",c,"FIELDS",e.length,...e],b)}},cx=class extends bL{constructor(a,b){const[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hpexpire",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},cy=class extends bL{constructor(a,b){const[c,d,e,f]=a,g=Array.isArray(d)?d:[d];super(["hpexpireat",c,e,...f?[f]:[],"FIELDS",g.length,...g],b)}},cz=class extends bL{constructor(a,b){const[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpexpiretime",c,"FIELDS",e.length,...e],b)}},cA=class extends bL{constructor(a,b){const[c,d]=a,e=Array.isArray(d)?d:[d];super(["hpttl",c,"FIELDS",e.length,...e],b)}},cB=class extends bL{constructor(a,b){super(["hget",...a],b)}},cC=class extends bL{constructor(a,b){super(["hgetall",...a],{deserialize:a=>(function(a){if(0===a.length)return null;let b={};for(let c=0;c<a.length;c+=2){let d=a[c],e=a[c+1];try{let a=!Number.isNaN(Number(e))&&!Number.isSafeInteger(Number(e));b[d]=a?e:JSON.parse(e)}catch{b[d]=e}}return b})(a),...b})}},cD=class extends bL{constructor(a,b){super(["hincrby",...a],b)}},cE=class extends bL{constructor(a,b){super(["hincrbyfloat",...a],b)}},cF=class extends bL{constructor([a],b){super(["hkeys",a],b)}},cG=class extends bL{constructor(a,b){super(["hlen",...a],b)}},cH=class extends bL{constructor([a,...b],c){super(["hmget",a,...b],{deserialize:a=>(function(a,b){if(b.every(a=>null===a))return null;let c={};for(let[d,e]of a.entries())try{c[e]=JSON.parse(b[d])}catch{c[e]=b[d]}return c})(b,a),...c})}},cI=class extends bL{constructor([a,b],c){super(["hmset",a,...Object.entries(b).flatMap(([a,b])=>[a,b])],c)}},cJ=class extends bL{constructor([a,b,c],d){const e=["hscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:bD,...d})}},cK=class extends bL{constructor([a,b],c){super(["hset",a,...Object.entries(b).flatMap(([a,b])=>[a,b])],c)}},cL=class extends bL{constructor(a,b){super(["hsetnx",...a],b)}},cM=class extends bL{constructor(a,b){super(["hstrlen",...a],b)}},cN=class extends bL{constructor(a,b){const[c,d]=a,e=Array.isArray(d)?d:[d];super(["httl",c,"FIELDS",e.length,...e],b)}},cO=class extends bL{constructor(a,b){super(["hvals",...a],b)}},cP=class extends bL{constructor(a,b){super(["incr",...a],b)}},cQ=class extends bL{constructor(a,b){super(["incrby",...a],b)}},cR=class extends bL{constructor(a,b){super(["incrbyfloat",...a],b)}},cS=class extends bL{constructor(a,b){super(["JSON.ARRAPPEND",...a],b)}},cT=class extends bL{constructor(a,b){super(["JSON.ARRINDEX",...a],b)}},cU=class extends bL{constructor(a,b){super(["JSON.ARRINSERT",...a],b)}},cV=class extends bL{constructor(a,b){super(["JSON.ARRLEN",a[0],a[1]??"$"],b)}},cW=class extends bL{constructor(a,b){super(["JSON.ARRPOP",...a],b)}},cX=class extends bL{constructor(a,b){const c=a[1]??"$";super(["JSON.ARRTRIM",a[0],c,a[2]??0,a[3]??0],b)}},cY=class extends bL{constructor(a,b){super(["JSON.CLEAR",...a],b)}},cZ=class extends bL{constructor(a,b){super(["JSON.DEL",...a],b)}},c$=class extends bL{constructor(a,b){super(["JSON.FORGET",...a],b)}},c_=class extends bL{constructor(a,b){const c=["JSON.GET"];"string"==typeof a[1]?c.push(...a):(c.push(a[0]),a[1]&&(a[1].indent&&c.push("INDENT",a[1].indent),a[1].newline&&c.push("NEWLINE",a[1].newline),a[1].space&&c.push("SPACE",a[1].space)),c.push(...a.slice(2))),super(c,b)}},c0=class extends bL{constructor(a,b){super(["JSON.MERGE",...a],b)}},c1=class extends bL{constructor(a,b){super(["JSON.MGET",...a[0],a[1]],b)}},c2=class extends bL{constructor(a,b){const c=["JSON.MSET"];for(const b of a)c.push(b.key,b.path,b.value);super(c,b)}},c3=class extends bL{constructor(a,b){super(["JSON.NUMINCRBY",...a],b)}},c4=class extends bL{constructor(a,b){super(["JSON.NUMMULTBY",...a],b)}},c5=class extends bL{constructor(a,b){super(["JSON.OBJKEYS",...a],b)}},c6=class extends bL{constructor(a,b){super(["JSON.OBJLEN",...a],b)}},c7=class extends bL{constructor(a,b){super(["JSON.RESP",...a],b)}},c8=class extends bL{constructor(a,b){const c=["JSON.SET",a[0],a[1],a[2]];a[3]&&(a[3].nx?c.push("NX"):a[3].xx&&c.push("XX")),super(c,b)}},c9=class extends bL{constructor(a,b){super(["JSON.STRAPPEND",...a],b)}},da=class extends bL{constructor(a,b){super(["JSON.STRLEN",...a],b)}},db=class extends bL{constructor(a,b){super(["JSON.TOGGLE",...a],b)}},dc=class extends bL{constructor(a,b){super(["JSON.TYPE",...a],b)}},dd=class extends bL{constructor(a,b){super(["keys",...a],b)}},de=class extends bL{constructor(a,b){super(["lindex",...a],b)}},df=class extends bL{constructor(a,b){super(["linsert",...a],b)}},dg=class extends bL{constructor(a,b){super(["llen",...a],b)}},dh=class extends bL{constructor(a,b){super(["lmove",...a],b)}},di=class extends bL{constructor(a,b){const[c,d,e,f]=a;super(["LMPOP",c,...d,e,...f?["COUNT",f]:[]],b)}},dj=class extends bL{constructor(a,b){super(["lpop",...a],b)}},dk=class extends bL{constructor(a,b){const c=["lpos",a[0],a[1]];"number"==typeof a[2]?.rank&&c.push("rank",a[2].rank),"number"==typeof a[2]?.count&&c.push("count",a[2].count),"number"==typeof a[2]?.maxLen&&c.push("maxLen",a[2].maxLen),super(c,b)}},dl=class extends bL{constructor(a,b){super(["lpush",...a],b)}},dm=class extends bL{constructor(a,b){super(["lpushx",...a],b)}},dn=class extends bL{constructor(a,b){super(["lrange",...a],b)}},dp=class extends bL{constructor(a,b){super(["lrem",...a],b)}},dq=class extends bL{constructor(a,b){super(["lset",...a],b)}},dr=class extends bL{constructor(a,b){super(["ltrim",...a],b)}},ds=class extends bL{constructor(a,b){super(["mget",...Array.isArray(a[0])?a[0]:a],b)}},dt=class extends bL{constructor([a],b){super(["mset",...Object.entries(a).flatMap(([a,b])=>[a,b])],b)}},du=class extends bL{constructor([a],b){super(["msetnx",...Object.entries(a).flat()],b)}},dv=class extends bL{constructor(a,b){super(["persist",...a],b)}},dw=class extends bL{constructor(a,b){super(["pexpire",...a],b)}},dx=class extends bL{constructor(a,b){super(["pexpireat",...a],b)}},dy=class extends bL{constructor(a,b){super(["pfadd",...a],b)}},dz=class extends bL{constructor(a,b){super(["pfcount",...a],b)}},dA=class extends bL{constructor(a,b){super(["pfmerge",...a],b)}},dB=class extends bL{constructor(a,b){const c=["ping"];a?.[0]!==void 0&&c.push(a[0]),super(c,b)}},dC=class extends bL{constructor(a,b){super(["psetex",...a],b)}},dD=class extends bL{constructor(a,b){super(["pttl",...a],b)}},dE=class extends bL{constructor(a,b){super(["publish",...a],b)}},dF=class extends bL{constructor(a){super(["randomkey"],a)}},dG=class extends bL{constructor(a,b){super(["rename",...a],b)}},dH=class extends bL{constructor(a,b){super(["renamenx",...a],b)}},dI=class extends bL{constructor(a,b){super(["rpop",...a],b)}},dJ=class extends bL{constructor(a,b){super(["rpush",...a],b)}},dK=class extends bL{constructor(a,b){super(["rpushx",...a],b)}},dL=class extends bL{constructor(a,b){super(["sadd",...a],b)}},dM=class extends bL{constructor([a,b],c){const d=["scan",a];b?.match&&d.push("match",b.match),"number"==typeof b?.count&&d.push("count",b.count),b&&"withType"in b&&!0===b.withType?d.push("withtype"):b&&"type"in b&&b.type&&b.type.length>0&&d.push("type",b.type),super(d,{deserialize:b?.withType?bE:bD,...c})}},dN=class extends bL{constructor(a,b){super(["scard",...a],b)}},dO=class extends bL{constructor(a,b){super(["script","exists",...a],{deserialize:a=>a,...b})}},dP=class extends bL{constructor([a],b){const c=["script","flush"];a?.sync?c.push("sync"):a?.async&&c.push("async"),super(c,b)}},dQ=class extends bL{constructor(a,b){super(["script","load",...a],b)}},dR=class extends bL{constructor(a,b){super(["sdiff",...a],b)}},dS=class extends bL{constructor(a,b){super(["sdiffstore",...a],b)}},dT=class extends bL{constructor([a,b,c],d){const e=["set",a,b];c&&("nx"in c&&c.nx?e.push("nx"):"xx"in c&&c.xx&&e.push("xx"),"get"in c&&c.get&&e.push("get"),"ex"in c&&"number"==typeof c.ex?e.push("ex",c.ex):"px"in c&&"number"==typeof c.px?e.push("px",c.px):"exat"in c&&"number"==typeof c.exat?e.push("exat",c.exat):"pxat"in c&&"number"==typeof c.pxat?e.push("pxat",c.pxat):"keepTtl"in c&&c.keepTtl&&e.push("keepTtl")),super(e,d)}},dU=class extends bL{constructor(a,b){super(["setbit",...a],b)}},dV=class extends bL{constructor(a,b){super(["setex",...a],b)}},dW=class extends bL{constructor(a,b){super(["setnx",...a],b)}},dX=class extends bL{constructor(a,b){super(["setrange",...a],b)}},dY=class extends bL{constructor(a,b){super(["sinter",...a],b)}},dZ=class extends bL{constructor(a,b){super(["sinterstore",...a],b)}},d$=class extends bL{constructor(a,b){super(["sismember",...a],b)}},d_=class extends bL{constructor(a,b){super(["smembers",...a],b)}},d0=class extends bL{constructor(a,b){super(["smismember",a[0],...a[1]],b)}},d1=class extends bL{constructor(a,b){super(["smove",...a],b)}},d2=class extends bL{constructor([a,b],c){const d=["spop",a];"number"==typeof b&&d.push(b),super(d,c)}},d3=class extends bL{constructor([a,b],c){const d=["srandmember",a];"number"==typeof b&&d.push(b),super(d,c)}},d4=class extends bL{constructor(a,b){super(["srem",...a],b)}},d5=class extends bL{constructor([a,b,c],d){const e=["sscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:bD,...d})}},d6=class extends bL{constructor(a,b){super(["strlen",...a],b)}},d7=class extends bL{constructor(a,b){super(["sunion",...a],b)}},d8=class extends bL{constructor(a,b){super(["sunionstore",...a],b)}},d9=class extends bL{constructor(a){super(["time"],a)}},ea=class extends bL{constructor(a,b){super(["touch",...a],b)}},eb=class extends bL{constructor(a,b){super(["ttl",...a],b)}},ec=class extends bL{constructor(a,b){super(["type",...a],b)}},ed=class extends bL{constructor(a,b){super(["unlink",...a],b)}},ee=class extends bL{constructor([a,b,c],d){super(["XACK",a,b,...Array.isArray(c)?[...c]:[c]],d)}},ef=class extends bL{constructor([a,b,c,d],e){const f=["XADD",a];for(const[a,e]of(d&&(d.nomkStream&&f.push("NOMKSTREAM"),d.trim&&(f.push(d.trim.type,d.trim.comparison,d.trim.threshold),void 0!==d.trim.limit&&f.push("LIMIT",d.trim.limit))),f.push(b),Object.entries(c)))f.push(a,e);super(f,e)}},eg=class extends bL{constructor([a,b,c,d,e,f],g){const h=[];f?.count&&h.push("COUNT",f.count),f?.justId&&h.push("JUSTID"),super(["XAUTOCLAIM",a,b,c,d,e,...h],g)}},eh=class extends bL{constructor([a,b,c,d,e,f],g){const h=Array.isArray(e)?[...e]:[e],i=[];f?.idleMS&&i.push("IDLE",f.idleMS),f?.idleMS&&i.push("TIME",f.timeMS),f?.retryCount&&i.push("RETRYCOUNT",f.retryCount),f?.force&&i.push("FORCE"),f?.justId&&i.push("JUSTID"),f?.lastId&&i.push("LASTID",f.lastId),super(["XCLAIM",a,b,c,d,...h,...i],g)}},ei=class extends bL{constructor([a,b],c){super(["XDEL",a,...Array.isArray(b)?[...b]:[b]],c)}},ej=class extends bL{constructor([a,b],c){const d=["XGROUP"];switch(b.type){case"CREATE":d.push("CREATE",a,b.group,b.id),b.options&&(b.options.MKSTREAM&&d.push("MKSTREAM"),void 0!==b.options.ENTRIESREAD&&d.push("ENTRIESREAD",b.options.ENTRIESREAD.toString()));break;case"CREATECONSUMER":d.push("CREATECONSUMER",a,b.group,b.consumer);break;case"DELCONSUMER":d.push("DELCONSUMER",a,b.group,b.consumer);break;case"DESTROY":d.push("DESTROY",a,b.group);break;case"SETID":d.push("SETID",a,b.group,b.id),b.options?.ENTRIESREAD!==void 0&&d.push("ENTRIESREAD",b.options.ENTRIESREAD.toString());break;default:throw Error("Invalid XGROUP")}super(d,c)}},ek=class extends bL{constructor([a,b],c){const d=[];"CONSUMERS"===b.type?d.push("CONSUMERS",a,b.group):d.push("GROUPS",a),super(["XINFO",...d],c)}},el=class extends bL{constructor(a,b){super(["XLEN",...a],b)}},em=class extends bL{constructor([a,b,c,d,e,f],g){super(["XPENDING",a,b,...f?.idleTime?["IDLE",f.idleTime]:[],c,d,e,...f?.consumer===void 0?[]:Array.isArray(f.consumer)?[...f.consumer]:[f.consumer]],g)}},en=class extends bL{constructor([a,b,c,d],e){const f=["XRANGE",a,b,c];"number"==typeof d&&f.push("COUNT",d),super(f,{deserialize:a=>(function(a){let b={};for(let c of a)for(let a=0;a<c.length;a+=2){let d=c[a],e=c[a+1];d in b||(b[d]={});for(let a=0;a<e.length;a+=2){let c=e[a],f=e[a+1];try{b[d][c]=JSON.parse(f)}catch{b[d][c]=f}}}return b})(a),...e})}},eo=class extends bL{constructor([a,b,c],d){if(Array.isArray(a)&&Array.isArray(b)&&a.length!==b.length)throw Error("ERR Unbalanced XREAD list of streams: for each stream key an ID or '$' must be specified");const e=[];"number"==typeof c?.count&&e.push("COUNT",c.count),"number"==typeof c?.blockMS&&e.push("BLOCK",c.blockMS),e.push("STREAMS",...Array.isArray(a)?[...a]:[a],...Array.isArray(b)?[...b]:[b]),super(["XREAD",...e],d)}},ep=class extends bL{constructor([a,b,c,d,e],f){if(Array.isArray(c)&&Array.isArray(d)&&c.length!==d.length)throw Error("ERR Unbalanced XREADGROUP list of streams: for each stream key an ID or '$' must be specified");const g=[];"number"==typeof e?.count&&g.push("COUNT",e.count),"number"==typeof e?.blockMS&&g.push("BLOCK",e.blockMS),"boolean"==typeof e?.NOACK&&e.NOACK&&g.push("NOACK"),g.push("STREAMS",...Array.isArray(c)?[...c]:[c],...Array.isArray(d)?[...d]:[d]),super(["XREADGROUP","GROUP",a,b,...g],f)}},eq=class extends bL{constructor([a,b,c,d],e){const f=["XREVRANGE",a,b,c];"number"==typeof d&&f.push("COUNT",d),super(f,{deserialize:a=>(function(a){let b={};for(let c of a)for(let a=0;a<c.length;a+=2){let d=c[a],e=c[a+1];d in b||(b[d]={});for(let a=0;a<e.length;a+=2){let c=e[a],f=e[a+1];try{b[d][c]=JSON.parse(f)}catch{b[d][c]=f}}}return b})(a),...e})}},er=class extends bL{constructor([a,b],c){const{limit:d,strategy:e,threshold:f,exactness:g="~"}=b;super(["XTRIM",a,e,g,f,...d?["LIMIT",d]:[]],c)}},es=class extends bL{constructor([a,b,...c],d){const e=["zadd",a];"nx"in b&&b.nx?e.push("nx"):"xx"in b&&b.xx&&e.push("xx"),"ch"in b&&b.ch&&e.push("ch"),"incr"in b&&b.incr&&e.push("incr"),"lt"in b&&b.lt?e.push("lt"):"gt"in b&&b.gt&&e.push("gt"),"score"in b&&"member"in b&&e.push(b.score,b.member),e.push(...c.flatMap(({score:a,member:b})=>[a,b])),super(e,d)}},et=class extends bL{constructor(a,b){super(["zcard",...a],b)}},eu=class extends bL{constructor(a,b){super(["zcount",...a],b)}},ev=class extends bL{constructor(a,b){super(["zincrby",...a],b)}},ew=class extends bL{constructor([a,b,c,d],e){const f=["zinterstore",a,b];Array.isArray(c)?f.push(...c):f.push(c),d&&("weights"in d&&d.weights?f.push("weights",...d.weights):"weight"in d&&"number"==typeof d.weight&&f.push("weights",d.weight),"aggregate"in d&&f.push("aggregate",d.aggregate)),super(f,e)}},ex=class extends bL{constructor(a,b){super(["zlexcount",...a],b)}},ey=class extends bL{constructor([a,b],c){const d=["zpopmax",a];"number"==typeof b&&d.push(b),super(d,c)}},ez=class extends bL{constructor([a,b],c){const d=["zpopmin",a];"number"==typeof b&&d.push(b),super(d,c)}},eA=class extends bL{constructor([a,b,c,d],e){const f=["zrange",a,b,c];d?.byScore&&f.push("byscore"),d?.byLex&&f.push("bylex"),d?.rev&&f.push("rev"),d?.count!==void 0&&void 0!==d.offset&&f.push("limit",d.offset,d.count),d?.withScores&&f.push("withscores"),super(f,e)}},eB=class extends bL{constructor(a,b){super(["zrank",...a],b)}},eC=class extends bL{constructor(a,b){super(["zrem",...a],b)}},eD=class extends bL{constructor(a,b){super(["zremrangebylex",...a],b)}},eE=class extends bL{constructor(a,b){super(["zremrangebyrank",...a],b)}},eF=class extends bL{constructor(a,b){super(["zremrangebyscore",...a],b)}},eG=class extends bL{constructor(a,b){super(["zrevrank",...a],b)}},eH=class extends bL{constructor([a,b,c],d){const e=["zscan",a,b];c?.match&&e.push("match",c.match),"number"==typeof c?.count&&e.push("count",c.count),super(e,{deserialize:bD,...d})}},eI=class extends bL{constructor(a,b){super(["zscore",...a],b)}},eJ=class extends bL{constructor([a,b,c],d){const e=["zunion",a];Array.isArray(b)?e.push(...b):e.push(b),c&&("weights"in c&&c.weights?e.push("weights",...c.weights):"weight"in c&&"number"==typeof c.weight&&e.push("weights",c.weight),"aggregate"in c&&e.push("aggregate",c.aggregate),c.withScores&&e.push("withscores")),super(e,d)}},eK=class extends bL{constructor([a,b,c,d],e){const f=["zunionstore",a,b];Array.isArray(c)?f.push(...c):f.push(c),d&&("weights"in d&&d.weights?f.push("weights",...d.weights):"weight"in d&&"number"==typeof d.weight&&f.push("weights",d.weight),"aggregate"in d&&f.push("aggregate",d.aggregate)),super(f,e)}},eL=class extends bL{constructor(a,b){super(["zdiffstore",...a],b)}},eM=class extends bL{constructor(a,b){const[c,d]=a;super(["zmscore",c,...d],b)}},eN=class{client;commands;commandOptions;multiExec;constructor(a){if(this.client=a.client,this.commands=[],this.commandOptions=a.commandOptions,this.multiExec=a.multiExec??!1,this.commandOptions?.latencyLogging){const a=this.exec.bind(this);this.exec=async b=>{let c=performance.now(),d=await (b?a(b):a()),e=(performance.now()-c).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.multiExec?["MULTI-EXEC"]:["PIPELINE"].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${e} ms\x1b[0m`),d}}}exec=async a=>{if(0===this.commands.length)throw Error("Pipeline is empty");let b=this.multiExec?["multi-exec"]:["pipeline"],c=await this.client.request({path:b,body:Object.values(this.commands).map(a=>a.command)});return a?.keepErrors?c.map(({error:a,result:b},c)=>({error:a,result:this.commands[c].deserialize(b)})):c.map(({error:a,result:b},c)=>{if(a)throw new bz(`Command ${c+1} [ ${this.commands[c].command[0]} ] failed: ${a}`);return this.commands[c].deserialize(b)})};length(){return this.commands.length}chain(a){return this.commands.push(a),this}append=(...a)=>this.chain(new bN(a,this.commandOptions));bitcount=(...a)=>this.chain(new bO(a,this.commandOptions));bitfield=(...a)=>new bP(a,this.client,this.commandOptions,this.chain.bind(this));bitop=(a,b,c,...d)=>this.chain(new bQ([a,b,c,...d],this.commandOptions));bitpos=(...a)=>this.chain(new bR(a,this.commandOptions));copy=(...a)=>this.chain(new bS(a,this.commandOptions));zdiffstore=(...a)=>this.chain(new eL(a,this.commandOptions));dbsize=()=>this.chain(new bT(this.commandOptions));decr=(...a)=>this.chain(new bU(a,this.commandOptions));decrby=(...a)=>this.chain(new bV(a,this.commandOptions));del=(...a)=>this.chain(new bW(a,this.commandOptions));echo=(...a)=>this.chain(new bX(a,this.commandOptions));evalRo=(...a)=>this.chain(new bY(a,this.commandOptions));eval=(...a)=>this.chain(new bZ(a,this.commandOptions));evalshaRo=(...a)=>this.chain(new b$(a,this.commandOptions));evalsha=(...a)=>this.chain(new b_(a,this.commandOptions));exists=(...a)=>this.chain(new b1(a,this.commandOptions));expire=(...a)=>this.chain(new b2(a,this.commandOptions));expireat=(...a)=>this.chain(new b3(a,this.commandOptions));flushall=a=>this.chain(new b6(a,this.commandOptions));flushdb=(...a)=>this.chain(new b7(a,this.commandOptions));geoadd=(...a)=>this.chain(new cf(a,this.commandOptions));geodist=(...a)=>this.chain(new cg(a,this.commandOptions));geopos=(...a)=>this.chain(new ci(a,this.commandOptions));geohash=(...a)=>this.chain(new ch(a,this.commandOptions));geosearch=(...a)=>this.chain(new cj(a,this.commandOptions));geosearchstore=(...a)=>this.chain(new ck(a,this.commandOptions));get=(...a)=>this.chain(new cl(a,this.commandOptions));getbit=(...a)=>this.chain(new cm(a,this.commandOptions));getdel=(...a)=>this.chain(new cn(a,this.commandOptions));getex=(...a)=>this.chain(new co(a,this.commandOptions));getrange=(...a)=>this.chain(new cp(a,this.commandOptions));getset=(a,b)=>this.chain(new cq([a,b],this.commandOptions));hdel=(...a)=>this.chain(new cr(a,this.commandOptions));hexists=(...a)=>this.chain(new cs(a,this.commandOptions));hexpire=(...a)=>this.chain(new ct(a,this.commandOptions));hexpireat=(...a)=>this.chain(new cu(a,this.commandOptions));hexpiretime=(...a)=>this.chain(new cv(a,this.commandOptions));httl=(...a)=>this.chain(new cN(a,this.commandOptions));hpexpire=(...a)=>this.chain(new cx(a,this.commandOptions));hpexpireat=(...a)=>this.chain(new cy(a,this.commandOptions));hpexpiretime=(...a)=>this.chain(new cz(a,this.commandOptions));hpttl=(...a)=>this.chain(new cA(a,this.commandOptions));hpersist=(...a)=>this.chain(new cw(a,this.commandOptions));hget=(...a)=>this.chain(new cB(a,this.commandOptions));hgetall=(...a)=>this.chain(new cC(a,this.commandOptions));hincrby=(...a)=>this.chain(new cD(a,this.commandOptions));hincrbyfloat=(...a)=>this.chain(new cE(a,this.commandOptions));hkeys=(...a)=>this.chain(new cF(a,this.commandOptions));hlen=(...a)=>this.chain(new cG(a,this.commandOptions));hmget=(...a)=>this.chain(new cH(a,this.commandOptions));hmset=(a,b)=>this.chain(new cI([a,b],this.commandOptions));hrandfield=(a,b,c)=>this.chain(new bM([a,b,c],this.commandOptions));hscan=(...a)=>this.chain(new cJ(a,this.commandOptions));hset=(a,b)=>this.chain(new cK([a,b],this.commandOptions));hsetnx=(a,b,c)=>this.chain(new cL([a,b,c],this.commandOptions));hstrlen=(...a)=>this.chain(new cM(a,this.commandOptions));hvals=(...a)=>this.chain(new cO(a,this.commandOptions));incr=(...a)=>this.chain(new cP(a,this.commandOptions));incrby=(...a)=>this.chain(new cQ(a,this.commandOptions));incrbyfloat=(...a)=>this.chain(new cR(a,this.commandOptions));keys=(...a)=>this.chain(new dd(a,this.commandOptions));lindex=(...a)=>this.chain(new de(a,this.commandOptions));linsert=(a,b,c,d)=>this.chain(new df([a,b,c,d],this.commandOptions));llen=(...a)=>this.chain(new dg(a,this.commandOptions));lmove=(...a)=>this.chain(new dh(a,this.commandOptions));lpop=(...a)=>this.chain(new dj(a,this.commandOptions));lmpop=(...a)=>this.chain(new di(a,this.commandOptions));lpos=(...a)=>this.chain(new dk(a,this.commandOptions));lpush=(a,...b)=>this.chain(new dl([a,...b],this.commandOptions));lpushx=(a,...b)=>this.chain(new dm([a,...b],this.commandOptions));lrange=(...a)=>this.chain(new dn(a,this.commandOptions));lrem=(a,b,c)=>this.chain(new dp([a,b,c],this.commandOptions));lset=(a,b,c)=>this.chain(new dq([a,b,c],this.commandOptions));ltrim=(...a)=>this.chain(new dr(a,this.commandOptions));mget=(...a)=>this.chain(new ds(a,this.commandOptions));mset=a=>this.chain(new dt([a],this.commandOptions));msetnx=a=>this.chain(new du([a],this.commandOptions));persist=(...a)=>this.chain(new dv(a,this.commandOptions));pexpire=(...a)=>this.chain(new dw(a,this.commandOptions));pexpireat=(...a)=>this.chain(new dx(a,this.commandOptions));pfadd=(...a)=>this.chain(new dy(a,this.commandOptions));pfcount=(...a)=>this.chain(new dz(a,this.commandOptions));pfmerge=(...a)=>this.chain(new dA(a,this.commandOptions));ping=a=>this.chain(new dB(a,this.commandOptions));psetex=(a,b,c)=>this.chain(new dC([a,b,c],this.commandOptions));pttl=(...a)=>this.chain(new dD(a,this.commandOptions));publish=(...a)=>this.chain(new dE(a,this.commandOptions));randomkey=()=>this.chain(new dF(this.commandOptions));rename=(...a)=>this.chain(new dG(a,this.commandOptions));renamenx=(...a)=>this.chain(new dH(a,this.commandOptions));rpop=(...a)=>this.chain(new dI(a,this.commandOptions));rpush=(a,...b)=>this.chain(new dJ([a,...b],this.commandOptions));rpushx=(a,...b)=>this.chain(new dK([a,...b],this.commandOptions));sadd=(a,b,...c)=>this.chain(new dL([a,b,...c],this.commandOptions));scan=(...a)=>this.chain(new dM(a,this.commandOptions));scard=(...a)=>this.chain(new dN(a,this.commandOptions));scriptExists=(...a)=>this.chain(new dO(a,this.commandOptions));scriptFlush=(...a)=>this.chain(new dP(a,this.commandOptions));scriptLoad=(...a)=>this.chain(new dQ(a,this.commandOptions));sdiff=(...a)=>this.chain(new dR(a,this.commandOptions));sdiffstore=(...a)=>this.chain(new dS(a,this.commandOptions));set=(a,b,c)=>this.chain(new dT([a,b,c],this.commandOptions));setbit=(...a)=>this.chain(new dU(a,this.commandOptions));setex=(a,b,c)=>this.chain(new dV([a,b,c],this.commandOptions));setnx=(a,b)=>this.chain(new dW([a,b],this.commandOptions));setrange=(...a)=>this.chain(new dX(a,this.commandOptions));sinter=(...a)=>this.chain(new dY(a,this.commandOptions));sinterstore=(...a)=>this.chain(new dZ(a,this.commandOptions));sismember=(a,b)=>this.chain(new d$([a,b],this.commandOptions));smembers=(...a)=>this.chain(new d_(a,this.commandOptions));smismember=(a,b)=>this.chain(new d0([a,b],this.commandOptions));smove=(a,b,c)=>this.chain(new d1([a,b,c],this.commandOptions));spop=(...a)=>this.chain(new d2(a,this.commandOptions));srandmember=(...a)=>this.chain(new d3(a,this.commandOptions));srem=(a,...b)=>this.chain(new d4([a,...b],this.commandOptions));sscan=(...a)=>this.chain(new d5(a,this.commandOptions));strlen=(...a)=>this.chain(new d6(a,this.commandOptions));sunion=(...a)=>this.chain(new d7(a,this.commandOptions));sunionstore=(...a)=>this.chain(new d8(a,this.commandOptions));time=()=>this.chain(new d9(this.commandOptions));touch=(...a)=>this.chain(new ea(a,this.commandOptions));ttl=(...a)=>this.chain(new eb(a,this.commandOptions));type=(...a)=>this.chain(new ec(a,this.commandOptions));unlink=(...a)=>this.chain(new ed(a,this.commandOptions));zadd=(...a)=>("score"in a[1],this.chain(new es([a[0],a[1],...a.slice(2)],this.commandOptions)));xadd=(...a)=>this.chain(new ef(a,this.commandOptions));xack=(...a)=>this.chain(new ee(a,this.commandOptions));xdel=(...a)=>this.chain(new ei(a,this.commandOptions));xgroup=(...a)=>this.chain(new ej(a,this.commandOptions));xread=(...a)=>this.chain(new eo(a,this.commandOptions));xreadgroup=(...a)=>this.chain(new ep(a,this.commandOptions));xinfo=(...a)=>this.chain(new ek(a,this.commandOptions));xlen=(...a)=>this.chain(new el(a,this.commandOptions));xpending=(...a)=>this.chain(new em(a,this.commandOptions));xclaim=(...a)=>this.chain(new eh(a,this.commandOptions));xautoclaim=(...a)=>this.chain(new eg(a,this.commandOptions));xtrim=(...a)=>this.chain(new er(a,this.commandOptions));xrange=(...a)=>this.chain(new en(a,this.commandOptions));xrevrange=(...a)=>this.chain(new eq(a,this.commandOptions));zcard=(...a)=>this.chain(new et(a,this.commandOptions));zcount=(...a)=>this.chain(new eu(a,this.commandOptions));zincrby=(a,b,c)=>this.chain(new ev([a,b,c],this.commandOptions));zinterstore=(...a)=>this.chain(new ew(a,this.commandOptions));zlexcount=(...a)=>this.chain(new ex(a,this.commandOptions));zmscore=(...a)=>this.chain(new eM(a,this.commandOptions));zpopmax=(...a)=>this.chain(new ey(a,this.commandOptions));zpopmin=(...a)=>this.chain(new ez(a,this.commandOptions));zrange=(...a)=>this.chain(new eA(a,this.commandOptions));zrank=(a,b)=>this.chain(new eB([a,b],this.commandOptions));zrem=(a,...b)=>this.chain(new eC([a,...b],this.commandOptions));zremrangebylex=(...a)=>this.chain(new eD(a,this.commandOptions));zremrangebyrank=(...a)=>this.chain(new eE(a,this.commandOptions));zremrangebyscore=(...a)=>this.chain(new eF(a,this.commandOptions));zrevrank=(a,b)=>this.chain(new eG([a,b],this.commandOptions));zscan=(...a)=>this.chain(new eH(a,this.commandOptions));zscore=(a,b)=>this.chain(new eI([a,b],this.commandOptions));zunionstore=(...a)=>this.chain(new eK(a,this.commandOptions));zunion=(...a)=>this.chain(new eJ(a,this.commandOptions));get json(){return{arrappend:(...a)=>this.chain(new cS(a,this.commandOptions)),arrindex:(...a)=>this.chain(new cT(a,this.commandOptions)),arrinsert:(...a)=>this.chain(new cU(a,this.commandOptions)),arrlen:(...a)=>this.chain(new cV(a,this.commandOptions)),arrpop:(...a)=>this.chain(new cW(a,this.commandOptions)),arrtrim:(...a)=>this.chain(new cX(a,this.commandOptions)),clear:(...a)=>this.chain(new cY(a,this.commandOptions)),del:(...a)=>this.chain(new cZ(a,this.commandOptions)),forget:(...a)=>this.chain(new c$(a,this.commandOptions)),get:(...a)=>this.chain(new c_(a,this.commandOptions)),merge:(...a)=>this.chain(new c0(a,this.commandOptions)),mget:(...a)=>this.chain(new c1(a,this.commandOptions)),mset:(...a)=>this.chain(new c2(a,this.commandOptions)),numincrby:(...a)=>this.chain(new c3(a,this.commandOptions)),nummultby:(...a)=>this.chain(new c4(a,this.commandOptions)),objkeys:(...a)=>this.chain(new c5(a,this.commandOptions)),objlen:(...a)=>this.chain(new c6(a,this.commandOptions)),resp:(...a)=>this.chain(new c7(a,this.commandOptions)),set:(...a)=>this.chain(new c8(a,this.commandOptions)),strappend:(...a)=>this.chain(new c9(a,this.commandOptions)),strlen:(...a)=>this.chain(new da(a,this.commandOptions)),toggle:(...a)=>this.chain(new db(a,this.commandOptions)),type:(...a)=>this.chain(new dc(a,this.commandOptions))}}get functions(){return{load:(...a)=>this.chain(new cc(a,this.commandOptions)),list:(...a)=>this.chain(new ca(a,this.commandOptions)),delete:(...a)=>this.chain(new b8(a,this.commandOptions)),flush:()=>this.chain(new b9(this.commandOptions)),stats:()=>this.chain(new cd(this.commandOptions)),call:(...a)=>this.chain(new b4(a,this.commandOptions)),callRo:(...a)=>this.chain(new b5(a,this.commandOptions))}}},eO=new Set(["scan","keys","flushdb","flushall","dbsize","hscan","hgetall","hkeys","lrange","sscan","smembers","xrange","xrevrange","zscan","zrange","exec"]),eP=class{pipelinePromises=new WeakMap;activePipeline=null;indexInCurrentPipeline=0;redis;pipeline;pipelineCounter=0;constructor(a){this.redis=a,this.pipeline=a.pipeline()}async withAutoPipeline(a){let b=this.activePipeline??this.redis.pipeline();this.activePipeline||(this.activePipeline=b,this.indexInCurrentPipeline=0);let c=this.indexInCurrentPipeline++;a(b);let d=this.deferExecution().then(()=>{if(!this.pipelinePromises.has(b)){let a=b.exec({keepErrors:!0});this.pipelineCounter+=1,this.pipelinePromises.set(b,a),this.activePipeline=null}return this.pipelinePromises.get(b)}),e=(await d)[c];if(e.error)throw new bz(`Command failed: ${e.error}`);return e.result}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},eQ=class extends bL{constructor(a,b){super([],{...b,headers:{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},path:["psubscribe",...a],streamOptions:{isStreaming:!0,onMessage:b?.streamOptions?.onMessage,signal:b?.streamOptions?.signal}})}},eR=class extends EventTarget{subscriptions;client;listeners;opts;constructor(a,b,c=!1,d){for(const e of(super(),this.client=a,this.subscriptions=new Map,this.listeners=new Map,this.opts=d,b))c?this.subscribeToPattern(e):this.subscribeToChannel(e)}subscribeToChannel(a){let b=new AbortController,c=new eS([a],{streamOptions:{signal:b.signal,onMessage:a=>this.handleMessage(a,!1)}});c.exec(this.client).catch(a=>{"AbortError"!==a.name&&this.dispatchToListeners("error",a)}),this.subscriptions.set(a,{command:c,controller:b,isPattern:!1})}subscribeToPattern(a){let b=new AbortController,c=new eQ([a],{streamOptions:{signal:b.signal,onMessage:a=>this.handleMessage(a,!0)}});c.exec(this.client).catch(a=>{"AbortError"!==a.name&&this.dispatchToListeners("error",a)}),this.subscriptions.set(a,{command:c,controller:b,isPattern:!0})}handleMessage(a,b){let c=a.replace(/^data:\s*/,""),d=c.indexOf(","),e=c.indexOf(",",d+1),f=b?c.indexOf(",",e+1):-1;if(-1!==d&&-1!==e){let a=c.slice(0,d);if(b&&"pmessage"===a&&-1!==f){let a=c.slice(d+1,e),b=c.slice(e+1,f),g=c.slice(f+1);try{let c=this.opts?.automaticDeserialization===!1?g:JSON.parse(g);this.dispatchToListeners("pmessage",{pattern:a,channel:b,message:c}),this.dispatchToListeners(`pmessage:${a}`,{pattern:a,channel:b,message:c})}catch(a){this.dispatchToListeners("error",Error(`Failed to parse message: ${a}`))}}else{let b=c.slice(d+1,e),f=c.slice(e+1);try{if("subscribe"===a||"psubscribe"===a||"unsubscribe"===a||"punsubscribe"===a){let b=Number.parseInt(f);this.dispatchToListeners(a,b)}else{let c=this.opts?.automaticDeserialization===!1?f:eT(f);this.dispatchToListeners(a,{channel:b,message:c}),this.dispatchToListeners(`${a}:${b}`,{channel:b,message:c})}}catch(a){this.dispatchToListeners("error",Error(`Failed to parse message: ${a}`))}}}}dispatchToListeners(a,b){let c=this.listeners.get(a);if(c)for(let a of c)a(b)}on(a,b){this.listeners.has(a)||this.listeners.set(a,new Set),this.listeners.get(a)?.add(b)}removeAllListeners(){this.listeners.clear()}async unsubscribe(a){if(a)for(let b of a){let a=this.subscriptions.get(b);if(a){try{a.controller.abort()}catch{}this.subscriptions.delete(b)}}else{for(let a of this.subscriptions.values())try{a.controller.abort()}catch{}this.subscriptions.clear(),this.removeAllListeners()}}getSubscribedChannels(){return[...this.subscriptions.keys()]}},eS=class extends bL{constructor(a,b){super([],{...b,headers:{Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},path:["subscribe",...a],streamOptions:{isStreaming:!0,onMessage:b?.streamOptions?.onMessage,signal:b?.streamOptions?.signal}})}},eT=a=>{try{return JSON.parse(a)}catch{return a}},eU=class{script;sha1;redis;constructor(a,b){this.redis=a,this.script=b,this.sha1="",this.init(b)}async init(a){this.sha1||(this.sha1=await this.digest(a))}async eval(a,b){return await this.init(this.script),await this.redis.eval(this.script,a,b)}async evalsha(a,b){return await this.init(this.script),await this.redis.evalsha(this.sha1,a,b)}async exec(a,b){return await this.init(this.script),await this.redis.evalsha(this.sha1,a,b).catch(async c=>{if(c instanceof Error&&c.message.toLowerCase().includes("noscript"))return await this.redis.eval(this.script,a,b);throw c})}async digest(a){let b=new TextEncoder().encode(a);return[...new Uint8Array(await bu.digest("SHA-1",b))].map(a=>a.toString(16).padStart(2,"0")).join("")}},eV=class{script;sha1;redis;constructor(a,b){this.redis=a,this.sha1="",this.script=b,this.init(b)}async init(a){this.sha1||(this.sha1=await this.digest(a))}async evalRo(a,b){return await this.init(this.script),await this.redis.evalRo(this.script,a,b)}async evalshaRo(a,b){return await this.init(this.script),await this.redis.evalshaRo(this.sha1,a,b)}async exec(a,b){return await this.init(this.script),await this.redis.evalshaRo(this.sha1,a,b).catch(async c=>{if(c instanceof Error&&c.message.toLowerCase().includes("noscript"))return await this.redis.evalRo(this.script,a,b);throw c})}async digest(a){let b=new TextEncoder().encode(a);return[...new Uint8Array(await bu.digest("SHA-1",b))].map(a=>a.toString(16).padStart(2,"0")).join("")}},eW=class{client;opts;enableTelemetry;enableAutoPipelining;constructor(a,b){this.client=a,this.opts=b,this.enableTelemetry=b?.enableTelemetry??!0,b?.readYourWrites===!1&&(this.client.readYourWrites=!1),this.enableAutoPipelining=b?.enableAutoPipelining??!0}get readYourWritesSyncToken(){return this.client.upstashSyncToken}set readYourWritesSyncToken(a){this.client.upstashSyncToken=a}get json(){return{arrappend:(...a)=>new cS(a,this.opts).exec(this.client),arrindex:(...a)=>new cT(a,this.opts).exec(this.client),arrinsert:(...a)=>new cU(a,this.opts).exec(this.client),arrlen:(...a)=>new cV(a,this.opts).exec(this.client),arrpop:(...a)=>new cW(a,this.opts).exec(this.client),arrtrim:(...a)=>new cX(a,this.opts).exec(this.client),clear:(...a)=>new cY(a,this.opts).exec(this.client),del:(...a)=>new cZ(a,this.opts).exec(this.client),forget:(...a)=>new c$(a,this.opts).exec(this.client),get:(...a)=>new c_(a,this.opts).exec(this.client),merge:(...a)=>new c0(a,this.opts).exec(this.client),mget:(...a)=>new c1(a,this.opts).exec(this.client),mset:(...a)=>new c2(a,this.opts).exec(this.client),numincrby:(...a)=>new c3(a,this.opts).exec(this.client),nummultby:(...a)=>new c4(a,this.opts).exec(this.client),objkeys:(...a)=>new c5(a,this.opts).exec(this.client),objlen:(...a)=>new c6(a,this.opts).exec(this.client),resp:(...a)=>new c7(a,this.opts).exec(this.client),set:(...a)=>new c8(a,this.opts).exec(this.client),strappend:(...a)=>new c9(a,this.opts).exec(this.client),strlen:(...a)=>new da(a,this.opts).exec(this.client),toggle:(...a)=>new db(a,this.opts).exec(this.client),type:(...a)=>new dc(a,this.opts).exec(this.client)}}get functions(){return{load:(...a)=>new cc(a,this.opts).exec(this.client),list:(...a)=>new ca(a,this.opts).exec(this.client),delete:(...a)=>new b8(a,this.opts).exec(this.client),flush:()=>new b9(this.opts).exec(this.client),stats:()=>new cd(this.opts).exec(this.client),call:(...a)=>new b4(a,this.opts).exec(this.client),callRo:(...a)=>new b5(a,this.opts).exec(this.client)}}use=a=>{let b=this.client.request.bind(this.client);this.client.request=c=>a(c,b)};addTelemetry=a=>{if(this.enableTelemetry)try{this.client.mergeTelemetry(a)}catch{}};createScript(a,b){return b?.readonly?new eV(this,a):new eU(this,a)}pipeline=()=>new eN({client:this.client,commandOptions:this.opts,multiExec:!1});autoPipeline=()=>(function a(b,c="root"){return b.autoPipelineExecutor||(b.autoPipelineExecutor=new eP(b)),new Proxy(b,{get:(b,d)=>{if("pipelineCounter"===d)return b.autoPipelineExecutor.pipelineCounter;if("root"===c&&"json"===d)return a(b,"json");if("root"===c&&"functions"===d)return a(b,"functions");if("root"===c){let a=d in b&&!(d in b.autoPipelineExecutor.pipeline),c=eO.has(d);if(a||c)return b[d]}let e=b.autoPipelineExecutor.pipeline,f="json"===c?e.json[d]:"functions"===c?e.functions[d]:e[d];return"function"==typeof f?(...a)=>b.autoPipelineExecutor.withAutoPipeline(b=>{("json"===c?b.json[d]:"functions"===c?b.functions[d]:b[d])(...a)}):f}})})(this);multi=()=>new eN({client:this.client,commandOptions:this.opts,multiExec:!0});bitfield=(...a)=>new bP(a,this.client,this.opts);append=(...a)=>new bN(a,this.opts).exec(this.client);bitcount=(...a)=>new bO(a,this.opts).exec(this.client);bitop=(a,b,c,...d)=>new bQ([a,b,c,...d],this.opts).exec(this.client);bitpos=(...a)=>new bR(a,this.opts).exec(this.client);copy=(...a)=>new bS(a,this.opts).exec(this.client);dbsize=()=>new bT(this.opts).exec(this.client);decr=(...a)=>new bU(a,this.opts).exec(this.client);decrby=(...a)=>new bV(a,this.opts).exec(this.client);del=(...a)=>new bW(a,this.opts).exec(this.client);echo=(...a)=>new bX(a,this.opts).exec(this.client);evalRo=(...a)=>new bY(a,this.opts).exec(this.client);eval=(...a)=>new bZ(a,this.opts).exec(this.client);evalshaRo=(...a)=>new b$(a,this.opts).exec(this.client);evalsha=(...a)=>new b_(a,this.opts).exec(this.client);exec=a=>new b0(a,this.opts).exec(this.client);exists=(...a)=>new b1(a,this.opts).exec(this.client);expire=(...a)=>new b2(a,this.opts).exec(this.client);expireat=(...a)=>new b3(a,this.opts).exec(this.client);flushall=a=>new b6(a,this.opts).exec(this.client);flushdb=(...a)=>new b7(a,this.opts).exec(this.client);geoadd=(...a)=>new cf(a,this.opts).exec(this.client);geopos=(...a)=>new ci(a,this.opts).exec(this.client);geodist=(...a)=>new cg(a,this.opts).exec(this.client);geohash=(...a)=>new ch(a,this.opts).exec(this.client);geosearch=(...a)=>new cj(a,this.opts).exec(this.client);geosearchstore=(...a)=>new ck(a,this.opts).exec(this.client);get=(...a)=>new cl(a,this.opts).exec(this.client);getbit=(...a)=>new cm(a,this.opts).exec(this.client);getdel=(...a)=>new cn(a,this.opts).exec(this.client);getex=(...a)=>new co(a,this.opts).exec(this.client);getrange=(...a)=>new cp(a,this.opts).exec(this.client);getset=(a,b)=>new cq([a,b],this.opts).exec(this.client);hdel=(...a)=>new cr(a,this.opts).exec(this.client);hexists=(...a)=>new cs(a,this.opts).exec(this.client);hexpire=(...a)=>new ct(a,this.opts).exec(this.client);hexpireat=(...a)=>new cu(a,this.opts).exec(this.client);hexpiretime=(...a)=>new cv(a,this.opts).exec(this.client);httl=(...a)=>new cN(a,this.opts).exec(this.client);hpexpire=(...a)=>new cx(a,this.opts).exec(this.client);hpexpireat=(...a)=>new cy(a,this.opts).exec(this.client);hpexpiretime=(...a)=>new cz(a,this.opts).exec(this.client);hpttl=(...a)=>new cA(a,this.opts).exec(this.client);hpersist=(...a)=>new cw(a,this.opts).exec(this.client);hget=(...a)=>new cB(a,this.opts).exec(this.client);hgetall=(...a)=>new cC(a,this.opts).exec(this.client);hincrby=(...a)=>new cD(a,this.opts).exec(this.client);hincrbyfloat=(...a)=>new cE(a,this.opts).exec(this.client);hkeys=(...a)=>new cF(a,this.opts).exec(this.client);hlen=(...a)=>new cG(a,this.opts).exec(this.client);hmget=(...a)=>new cH(a,this.opts).exec(this.client);hmset=(a,b)=>new cI([a,b],this.opts).exec(this.client);hrandfield=(a,b,c)=>new bM([a,b,c],this.opts).exec(this.client);hscan=(...a)=>new cJ(a,this.opts).exec(this.client);hset=(a,b)=>new cK([a,b],this.opts).exec(this.client);hsetnx=(a,b,c)=>new cL([a,b,c],this.opts).exec(this.client);hstrlen=(...a)=>new cM(a,this.opts).exec(this.client);hvals=(...a)=>new cO(a,this.opts).exec(this.client);incr=(...a)=>new cP(a,this.opts).exec(this.client);incrby=(...a)=>new cQ(a,this.opts).exec(this.client);incrbyfloat=(...a)=>new cR(a,this.opts).exec(this.client);keys=(...a)=>new dd(a,this.opts).exec(this.client);lindex=(...a)=>new de(a,this.opts).exec(this.client);linsert=(a,b,c,d)=>new df([a,b,c,d],this.opts).exec(this.client);llen=(...a)=>new dg(a,this.opts).exec(this.client);lmove=(...a)=>new dh(a,this.opts).exec(this.client);lpop=(...a)=>new dj(a,this.opts).exec(this.client);lmpop=(...a)=>new di(a,this.opts).exec(this.client);lpos=(...a)=>new dk(a,this.opts).exec(this.client);lpush=(a,...b)=>new dl([a,...b],this.opts).exec(this.client);lpushx=(a,...b)=>new dm([a,...b],this.opts).exec(this.client);lrange=(...a)=>new dn(a,this.opts).exec(this.client);lrem=(a,b,c)=>new dp([a,b,c],this.opts).exec(this.client);lset=(a,b,c)=>new dq([a,b,c],this.opts).exec(this.client);ltrim=(...a)=>new dr(a,this.opts).exec(this.client);mget=(...a)=>new ds(a,this.opts).exec(this.client);mset=a=>new dt([a],this.opts).exec(this.client);msetnx=a=>new du([a],this.opts).exec(this.client);persist=(...a)=>new dv(a,this.opts).exec(this.client);pexpire=(...a)=>new dw(a,this.opts).exec(this.client);pexpireat=(...a)=>new dx(a,this.opts).exec(this.client);pfadd=(...a)=>new dy(a,this.opts).exec(this.client);pfcount=(...a)=>new dz(a,this.opts).exec(this.client);pfmerge=(...a)=>new dA(a,this.opts).exec(this.client);ping=a=>new dB(a,this.opts).exec(this.client);psetex=(a,b,c)=>new dC([a,b,c],this.opts).exec(this.client);psubscribe=a=>{let b=Array.isArray(a)?a:[a];return new eR(this.client,b,!0,this.opts)};pttl=(...a)=>new dD(a,this.opts).exec(this.client);publish=(...a)=>new dE(a,this.opts).exec(this.client);randomkey=()=>new dF().exec(this.client);rename=(...a)=>new dG(a,this.opts).exec(this.client);renamenx=(...a)=>new dH(a,this.opts).exec(this.client);rpop=(...a)=>new dI(a,this.opts).exec(this.client);rpush=(a,...b)=>new dJ([a,...b],this.opts).exec(this.client);rpushx=(a,...b)=>new dK([a,...b],this.opts).exec(this.client);sadd=(a,b,...c)=>new dL([a,b,...c],this.opts).exec(this.client);scan(a,b){return new dM([a,b],this.opts).exec(this.client)}scard=(...a)=>new dN(a,this.opts).exec(this.client);scriptExists=(...a)=>new dO(a,this.opts).exec(this.client);scriptFlush=(...a)=>new dP(a,this.opts).exec(this.client);scriptLoad=(...a)=>new dQ(a,this.opts).exec(this.client);sdiff=(...a)=>new dR(a,this.opts).exec(this.client);sdiffstore=(...a)=>new dS(a,this.opts).exec(this.client);set=(a,b,c)=>new dT([a,b,c],this.opts).exec(this.client);setbit=(...a)=>new dU(a,this.opts).exec(this.client);setex=(a,b,c)=>new dV([a,b,c],this.opts).exec(this.client);setnx=(a,b)=>new dW([a,b],this.opts).exec(this.client);setrange=(...a)=>new dX(a,this.opts).exec(this.client);sinter=(...a)=>new dY(a,this.opts).exec(this.client);sinterstore=(...a)=>new dZ(a,this.opts).exec(this.client);sismember=(a,b)=>new d$([a,b],this.opts).exec(this.client);smismember=(a,b)=>new d0([a,b],this.opts).exec(this.client);smembers=(...a)=>new d_(a,this.opts).exec(this.client);smove=(a,b,c)=>new d1([a,b,c],this.opts).exec(this.client);spop=(...a)=>new d2(a,this.opts).exec(this.client);srandmember=(...a)=>new d3(a,this.opts).exec(this.client);srem=(a,...b)=>new d4([a,...b],this.opts).exec(this.client);sscan=(...a)=>new d5(a,this.opts).exec(this.client);strlen=(...a)=>new d6(a,this.opts).exec(this.client);subscribe=a=>{let b=Array.isArray(a)?a:[a];return new eR(this.client,b,!1,this.opts)};sunion=(...a)=>new d7(a,this.opts).exec(this.client);sunionstore=(...a)=>new d8(a,this.opts).exec(this.client);time=()=>new d9().exec(this.client);touch=(...a)=>new ea(a,this.opts).exec(this.client);ttl=(...a)=>new eb(a,this.opts).exec(this.client);type=(...a)=>new ec(a,this.opts).exec(this.client);unlink=(...a)=>new ed(a,this.opts).exec(this.client);xadd=(...a)=>new ef(a,this.opts).exec(this.client);xack=(...a)=>new ee(a,this.opts).exec(this.client);xdel=(...a)=>new ei(a,this.opts).exec(this.client);xgroup=(...a)=>new ej(a,this.opts).exec(this.client);xread=(...a)=>new eo(a,this.opts).exec(this.client);xreadgroup=(...a)=>new ep(a,this.opts).exec(this.client);xinfo=(...a)=>new ek(a,this.opts).exec(this.client);xlen=(...a)=>new el(a,this.opts).exec(this.client);xpending=(...a)=>new em(a,this.opts).exec(this.client);xclaim=(...a)=>new eh(a,this.opts).exec(this.client);xautoclaim=(...a)=>new eg(a,this.opts).exec(this.client);xtrim=(...a)=>new er(a,this.opts).exec(this.client);xrange=(...a)=>new en(a,this.opts).exec(this.client);xrevrange=(...a)=>new eq(a,this.opts).exec(this.client);zadd=(...a)=>("score"in a[1],new es([a[0],a[1],...a.slice(2)],this.opts).exec(this.client));zcard=(...a)=>new et(a,this.opts).exec(this.client);zcount=(...a)=>new eu(a,this.opts).exec(this.client);zdiffstore=(...a)=>new eL(a,this.opts).exec(this.client);zincrby=(a,b,c)=>new ev([a,b,c],this.opts).exec(this.client);zinterstore=(...a)=>new ew(a,this.opts).exec(this.client);zlexcount=(...a)=>new ex(a,this.opts).exec(this.client);zmscore=(...a)=>new eM(a,this.opts).exec(this.client);zpopmax=(...a)=>new ey(a,this.opts).exec(this.client);zpopmin=(...a)=>new ez(a,this.opts).exec(this.client);zrange=(...a)=>new eA(a,this.opts).exec(this.client);zrank=(a,b)=>new eB([a,b],this.opts).exec(this.client);zrem=(a,...b)=>new eC([a,...b],this.opts).exec(this.client);zremrangebylex=(...a)=>new eD(a,this.opts).exec(this.client);zremrangebyrank=(...a)=>new eE(a,this.opts).exec(this.client);zremrangebyscore=(...a)=>new eF(a,this.opts).exec(this.client);zrevrank=(a,b)=>new eG([a,b],this.opts).exec(this.client);zscan=(...a)=>new eH(a,this.opts).exec(this.client);zscore=(a,b)=>new eI([a,b],this.opts).exec(this.client);zunion=(...a)=>new eJ(a,this.opts).exec(this.client);zunionstore=(...a)=>new eK(a,this.opts).exec(this.client)};"undefined"==typeof atob&&(a.g.atob=a=>Buffer.from(a,"base64").toString("utf8"));var eX=class a extends eW{constructor(a){if("request"in a)return void super(a);a.url?(a.url.startsWith(" ")||a.url.endsWith(" ")||/\r|\n/.test(a.url))&&console.warn("[Upstash Redis] The redis url contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'url' property is missing or undefined in your Redis config."),a.token?(a.token.startsWith(" ")||a.token.endsWith(" ")||/\r|\n/.test(a.token))&&console.warn("[Upstash Redis] The redis token contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'token' property is missing or undefined in your Redis config.");const b=new bG({baseUrl:a.url,retry:a.retry,headers:{authorization:`Bearer ${a.token}`},agent:a.agent,responseEncoding:a.responseEncoding,cache:a.cache??"no-store",signal:a.signal,keepAlive:a.keepAlive,readYourWrites:a.readYourWrites}),c="object"==typeof process&&process&&"object"==typeof process.env&&process.env?process.env:{};super(b,{automaticDeserialization:a.automaticDeserialization,enableTelemetry:a.enableTelemetry??!c.UPSTASH_DISABLE_TELEMETRY,latencyLogging:a.latencyLogging,enableAutoPipelining:a.enableAutoPipelining});const d="object"==typeof process&&process?process.version:void 0;if(this.addTelemetry({runtime:"string"==typeof EdgeRuntime?"edge-light":d?`node@${d}`:"unknown",platform:c.UPSTASH_CONSOLE?"console":c.VERCEL?"vercel":c.AWS_REGION?"aws":"unknown",sdk:"@upstash/redis@v1.36.0"}),this.enableAutoPipelining)return this.autoPipeline()}static fromEnv(b){if("object"!=typeof process||!process||"object"!=typeof process.env||!process.env)throw TypeError('[Upstash Redis] Unable to get environment variables, `process.env` is undefined. If you are deploying to cloudflare, please import from "@upstash/redis/cloudflare" instead');let c=process.env.UPSTASH_REDIS_REST_URL||process.env.KV_REST_API_URL;c||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_URL`");let d=process.env.UPSTASH_REDIS_REST_TOKEN||process.env.KV_REST_API_TOKEN;return d||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_TOKEN`"),new a({...b,url:c,token:d})}},eY=a.i(5324);if(!process.env.runash_KV_REST_API_URL||!process.env.runash_KV_REST_API_TOKEN)throw Error("Redis environment variables are not set");let eZ=new eX({url:process.env.runash_KV_REST_API_URL,token:process.env.runash_KV_REST_API_TOKEN}),e$=new eY.Ratelimit({redis:eZ,limiter:eY.Ratelimit.slidingWindow(5,"10 s"),analytics:!0,prefix:"@upstash/ratelimit"});var e_=a.i(56589),e0=a.i(10741);let e1=bs.object({identifier:bs.string().min(3,"Username or email is required"),password:bs.string().min(8,"Password must be at least 8 characters")}),e2=bs.object({email:bs.string().email("Invalid email address"),username:bs.string().min(3,"Username must be at least 3 characters"),name:bs.string().min(2,"Name must be at least 2 characters"),password:bs.string().min(8,"Password must be at least 8 characters")});async function e3(a){let b=(await (0,e_.headers)()).get("x-forwarded-for")??"127.0.0.1",{success:c}=await e$.limit(`login_${b}`);if(!c)return{error:"Too many attempts. Please try again later."};let d=e1.parse(Object.fromEntries(a)),e=d.identifier.includes("@")?await (0,k.getUserByEmail)(d.identifier):await (0,k.getUserByUsername)(d.identifier);if(!e||e.password_hash!==d.password)return{error:"Invalid credentials"};await (0,l.createSession)(e.id),(0,m.redirect)("/dashboard")}async function e4(a){let b=(await (0,e_.headers)()).get("x-forwarded-for")??"127.0.0.1",{success:c}=await e$.limit(`signup_${b}`);if(!c)return{error:"Too many attempts. Please try again later."};let d=e2.parse(Object.fromEntries(a));if(await (0,k.getUserByEmail)(d.email))return{error:"Email already exists"};if(await (0,k.getUserByUsername)(d.username))return{error:"Username already exists"};let e=(await k.sql`
    INSERT INTO users (email, username, name, password_hash, role)
    VALUES (${d.email}, ${d.username}, ${d.name}, ${d.password}, 'user')
    RETURNING id
  `)[0];if(!e)return{error:"Failed to create user"};await (0,l.createSession)(e.id),(0,m.redirect)("/dashboard")}async function e5(){await (0,l.deleteSession)(),(0,m.redirect)("/login")}(0,e0.ensureServerEntryExports)([e3,e4,e5]),(0,j.registerServerReference)(e3,"4005946794a8aae25a09fd9b58dc5a153959c9a12e",null),(0,j.registerServerReference)(e4,"40b88ed9ab565527d42c07da7b522bd69abe107f43",null),(0,j.registerServerReference)(e5,"00ab754ef3be4f7c832f55fdff8b76314a47afd334",null),a.s(["login",()=>e3,"logout",()=>e5,"signup",()=>e4],77728)}];

//# debugId=2ea77ee6-d627-4a88-bbb4-10ecc1fe5f03
//# sourceMappingURL=%5Broot-of-the-server%5D__ae84a22d._.js.map